# 音视频开发入门专栏计划（30 篇）

目标：通过 `ZenPlay` 项目，用 20–30 篇文章带读者从入门到实战，理论 + 实践并重，每篇控制在易读长度。

---

## 第一部分：音视频基础（1-5）

### 01. 音视频开发全景图：播放器是怎样炼成的
核心点：从点击播放到画面出现的端到端流程；容器 vs 编码、解封装→解码→渲染管线；实践：用 `ffprobe` 分析文件结构；对应代码：`Demuxer` 的工作流程。

### 02. 视频编码原理：为什么 1 小时电影只有几百 MB
核心点：帧内/帧间预测、熵编码与 GOP；I/P/B 帧的含义及码率与画质权衡；实践：FFmpeg 编码对比实验；对应代码：`VideoDecoder` 的帧类型处理。

### 03. 音频编码原理：人耳听不见的频率都被删掉了
核心点：采样、量化、心理声学模型；采样率与声道、常见编码（AAC/MP3）；实践：用 Audacity 可视化频谱；对应代码：`AudioDecoder` 输出 PCM 的处理。

### 04. 时间戳与同步：音画不同步的罪魁祸首
核心点：PTS/DTS/时间基概念，时基转换与帧显示时机；实践：用 FFprobe 查看时间戳并手算帧时长；对应代码：`AVSyncController` 的时钟管理。

### 05. FFmpeg 核心 API 快速入门
核心点：libavformat/libavcodec 的角色，AVFormatContext/AVCodecContext/AVFrame/AVPacket 用法；实践：写 50 行解码 Demo；对应代码：`Demuxer` 与 `VideoDecoder` 的封装。

---

## 第二部分：解封装与解码（6-10）

### 06. 解封装实战：从 MP4 提取音视频流
核心点：容器解析、流索引识别、读取 packet；实践：实现简单解封装器打印 Packet 信息；对应代码：`Demuxer` 的实现。

### 07. 视频解码实战：把 H.264 码流变成 YUV
核心点：解码 API（avcodec_send_packet / avcodec_receive_frame）循环与错误处理；实践：解码并保存第一帧为 YUV 文件；对应代码：`VideoDecoder` 的循环。

### 08. 音频解码实战：从 AAC 到可播放的 PCM
核心点：音频帧结构、planar/packed 区别、nb_samples 字段；实践：解码并导出 WAV；对应代码：`AudioDecoder` 与 `AudioResampler` 协作。

### 09. 硬件加速解码：让 GPU 干重活
核心点：硬解原理、hw_device_ctx 与 hw_frames_ctx、零拷贝思路；实践：比较软解与硬解的 CPU 占用；对应代码：`HWDecoderContext` 的 D3D11 管理。

### 10. 多线程解码：榨干 CPU 每一滴性能
核心点：FFmpeg 与应用层的线程模型，thread_count 的影响；实践：测试不同线程数的解码性能；对应代码：`VideoDecoder` 的线程配置。

---

## 第三部分：音频渲染（11-14）

### 11. 音频渲染基础：PCM 怎么变成声音
核心点：OS 音频子系统（WASAPI/ALSA/CoreAudio）与回调模式；实践：用 SDL 播放正弦波；对应代码：`AudioPlayer` 初始化。

### 12. 音频重采样：格式不匹配时的救星
核心点：采样率与声道转换、libswresample 的角色；实践：48k → 44.1k 转换示例；对应代码：`AudioResampler`。

### 13. 音频回调机制：你只有 10ms 填充缓冲区
核心点：回调驱动与推送模式、低延迟挑战；实践：测回调间隔与抖动；对应代码：`AudioPlayer` 的回调实现。

### 14. 音频卡顿排查：为何爆音断音
核心点：缓冲欠载/过载、队列管理与静音填充策略；实践：模拟解码卡顿并观察降级策略；对应代码：`AudioPlayer` 恢复逻辑。

---

## 第四部分：视频渲染（15-19）

### 15. 视频渲染基础：YUV 到 RGB 的颜色空间转换
核心点：YUV420P 结构、YUV→RGB 转换与 BT.601/709 的差别；实践：手写像素着色器实现转换；对应代码：`D3D11Renderer` 的 shader。

### 16. 跨平台渲染：SDL 与原生 API 的权衡
核心点：SDL2、D3D11、OpenGL/Metal 的性能与兼容性；实践：用 SDL 实现播放器窗口；对应代码：`SDLRenderer` 与 `D3D11Renderer`。

### 17. 零拷贝渲染：GPU 内存直通的黑科技
核心点：共享 D3D11 设备、SRV 缓存、BindFlags 要求；实践：对比零拷贝与传统拷贝的 CPU 与延迟；对应代码：`D3D11Renderer` 的 SRV 池。

### 18. 渲染优化：VSync 与帧率控制
核心点：VSync 原理、三缓冲、自适应同步权衡；实践：测试不同 Present 配置；对应代码：`D3D11SwapChain` 配置策略。

### 19. 高分辨率渲染：4K/8K 的挑战
核心点：带宽、纹理池大小、动态分辨率策略；实践：监控 GPU 带宽与内存占用；对应代码：`HWDecoderContext` 的纹理池调优。

---

## 第五部分：音视频同步（20-22）

### 20. 音视频同步原理：人的容忍度与主时钟选择
核心点：AUDIO_MASTER / VIDEO_MASTER / EXTERNAL_MASTER，时钟漂移与补偿；实践：模拟不同主时钟，观察体验；对应代码：`AVSyncController`。

### 21. 帧丢弃与重复：追赶时钟的策略
核心点：何时丢帧、何时重复帧、平滑与准确的权衡；实践：快速前进时测试丢帧策略；对应代码：`AVSyncController` 的调度策略。

### 22. 同步误差分析：用数据说话
核心点：误差测量方法（平均/最大/直方图），可视化同步偏差；实践：绘制误差曲线并分析；对应代码：`StatisticsSystem` 的统计模块。

---

## 第六部分：播放控制（23-25）

### 23. 状态机设计：播放器的 7 种状态
核心点：状态表与事件驱动、并发控制与线程安全；实践：画出状态转换图并验证边界条件；对应代码：`PlaybackController` 的状态机。

### 24. Seek 实现：跳转到任意时间点
核心点：关键帧 vs 精确 Seek、解码器 Flush 与缓存清理；实践：对比精确与快速 Seek 的速度与效果；对应代码：`Demuxer` 与解码器配合。

### 25. 暂停与恢复：看似简单实则复杂
核心点：时钟冻结、音频设备暂停与条件变量；实践：测暂停恢复的延迟与资源占用；对应代码：线程的 Pause/Resume 实现。


---

## 第七部分：架构与工程（26-28）

### 26. 多线程架构：7 个线程的分工协作
核心点：Demux/Decode/Render 线程模型、无锁队列与生产者-消费者；实践：用日志追踪一帧流转；对应代码：Loki 线程与各 Task 实现。

### 27. 内存管理：AVFrame 的生命周期
核心点：引用计数、av_frame_ref/unref、智能指针与内存池；实践：Valgrind 检测内存泄漏；对应代码：AVFrame 管理策略。

### 28. 性能优化：从理论到实测
核心点：性能剖析流程、缓存命中率、SRV 池等优化案例；实践：用 Profiler 定位热点并优化；对应代码：`StatisticsSystem` 与 SRV 缓存实现示例。

---