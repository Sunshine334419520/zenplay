# 15. è§†é¢‘æ¸²æŸ“åŸºç¡€ï¼šYUV åˆ° RGB çš„é¢œè‰²ç©ºé—´è½¬æ¢ï¼ˆä¸Šç¯‡ï¼šç†è®º + è§†è§‰åŒ–ï¼‰

> ä¸“æ å¯¼è¯»ï¼šè§£ç å™¨è¾“å‡ºçš„æ˜¯ YUV æ ¼å¼ï¼Œä½†æ˜¾ç¤ºå™¨åªè®¤è¯† RGBï¼æœ¬ç¯‡ç”¨ç›´è§‚ç¤ºæ„å›¾ã€Mermaid æµç¨‹å›¾å’Œæ•°å­¦å…¬å¼ï¼Œå¸¦ä½ æ·±å…¥ç†è§£ YUV/RGB é¢œè‰²ç©ºé—´çš„æœ¬è´¨ã€ä¸ºä»€ä¹ˆè§†é¢‘ç”¨ YUVã€ä»¥åŠè½¬æ¢çš„æ•°å­¦åŸç†ã€‚ä¸‹ä¸€ç¯‡å°†ç»“åˆ ZenPlay çš„ `D3D11Renderer` å®ç°ç»†èŠ‚ã€‚

---

## ğŸ¨ å¼€åœºï¼šä¸¤ç§"ç”»å¸ƒ"çš„è¯­è¨€

æƒ³è±¡ä½ åœ¨è°ƒè‰²æ¿å‰ä½œç”»â€”â€”

```
RGBï¼ˆæ˜¾ç¤ºå™¨çš„è¯­è¨€ï¼‰:
  - çº¢è‰²ï¼ˆRedï¼‰ã€ç»¿è‰²ï¼ˆGreenï¼‰ã€è“è‰²ï¼ˆBlueï¼‰ä¸‰åŸè‰²æ··åˆ
  - æ¯ä¸ªåƒç´  = (R, G, B) ä¸‰ä¸ªç‹¬ç«‹æ•°å€¼
  - ç›´è§‚ã€é€‚åˆæ˜¾ç¤ºï¼Œä½†æ•°æ®é‡å¤§

YUVï¼ˆè§†é¢‘ç¼–ç çš„è¯­è¨€ï¼‰:
  - Yï¼ˆäº®åº¦ Lumaï¼‰ï¼šé»‘ç™½ä¿¡æ¯ï¼Œäººçœ¼æœ€æ•æ„Ÿ
  - U/Vï¼ˆè‰²åº¦ Chromaï¼‰ï¼šé¢œè‰²ä¿¡æ¯ï¼Œäººçœ¼ä¸æ•æ„Ÿ
  - å¯ä»¥å‹ç¼© U/Vï¼ŒèŠ‚çœ 50% ç©ºé—´ï¼ˆYUV420ï¼‰
```

**æ ¸å¿ƒé—®é¢˜**ï¼šå¦‚ä½•æŠŠ YUVï¼ˆè§£ç å™¨è¾“å‡ºï¼‰è½¬æ¢æˆ RGBï¼ˆæ˜¾ç¤ºå™¨éœ€è¦ï¼‰ï¼Ÿè½¬æ¢çš„æ•°å­¦åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ“Š é…å›¾ Aï¼šRGB vs YUV å­˜å‚¨å¯¹æ¯”ï¼ˆAI æç¤ºè¯ï¼‰

- ä¸­æ–‡æç¤ºè¯ï¼š
  - ç™½è‰²èƒŒæ™¯ï¼Œ16:9 æ¨ªç‰ˆã€‚å·¦ä¾§æ˜¾ç¤º"RGB å­˜å‚¨"ï¼šä¸€ä¸ª 2Ã—2 åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­æ ‡æ³¨"R G B"ä¸‰ä¸ªåˆ†é‡ï¼ˆçº¢ç»¿è“å°æ–¹å—ï¼‰ï¼Œä¸‹æ–¹æ ‡æ³¨"4 åƒç´  = 12 ä¸ªåˆ†é‡"ã€‚å³ä¾§æ˜¾ç¤º"YUV420 å­˜å‚¨"ï¼šä¸Šæ–¹ 2Ã—2 ç½‘æ ¼æ¯ä¸ªæ ¼å­æ ‡æ³¨"Y"ï¼ˆç°è‰²ï¼‰ï¼Œä¸‹æ–¹ä¸¤ä¸ªå°æ ¼å­æ ‡æ³¨"U""V"ï¼ˆè“è‰²å’Œçº¢è‰²ï¼‰ï¼Œä¸‹æ–¹æ ‡æ³¨"4 åƒç´  = 6 ä¸ªåˆ†é‡ï¼ˆèŠ‚çœ 50%ï¼‰"ã€‚ä¸­é—´ç”¨åŒå‘ç®­å¤´è¿æ¥ï¼Œæ ‡æ³¨"é¢œè‰²ç©ºé—´è½¬æ¢ Color Space Conversion"ã€‚
- English prompt:
  - White background, 16:9 landscape. Left shows "RGB Storage": 2Ã—2 pixel grid, each cell labeled "R G B" components (red/green/blue squares), bottom note "4 pixels = 12 components". Right shows "YUV420 Storage": top 2Ã—2 grid each cell labeled "Y" (gray), bottom two small cells "U""V" (blue/red), note "4 pixels = 6 components (50% saving)". Middle connected by bidirectional arrow labeled "é¢œè‰²ç©ºé—´è½¬æ¢ Color Space Conversion".

---

## ğŸ”¬ YUV æ˜¯ä»€ä¹ˆï¼šåˆ†ç¦»äº®åº¦ä¸è‰²åº¦çš„æ™ºæ…§

### 1. ä¸ºä»€ä¹ˆè¦å‘æ˜ YUVï¼Ÿ

```
äººçœ¼ç‰¹æ€§ï¼š
  - å¯¹äº®åº¦å˜åŒ–ï¼ˆæ˜æš—ï¼‰éå¸¸æ•æ„Ÿ
  - å¯¹è‰²å½©å˜åŒ–ï¼ˆå½©è‰²ï¼‰ç›¸å¯¹ä¸æ•æ„Ÿ

YUV çš„è®¾è®¡æ€è·¯ï¼š
  1. æŠŠäº®åº¦ï¼ˆYï¼‰å’Œè‰²å½©ï¼ˆU/Vï¼‰åˆ†å¼€å­˜å‚¨
  2. äº®åº¦ä¿æŒå…¨åˆ†è¾¨ç‡ï¼ˆäººçœ¼æ•æ„Ÿï¼‰
  3. è‰²å½©é™ä½åˆ†è¾¨ç‡ï¼ˆäººçœ¼ä¸æ•æ„Ÿï¼‰â†’ èŠ‚çœç©ºé—´ï¼
```

**å†å²èƒŒæ™¯**ï¼šYUV æœ€åˆæ˜¯ä¸ºäº†è®©é»‘ç™½ç”µè§†å’Œå½©è‰²ç”µè§†å…¼å®¹ã€‚é»‘ç™½ç”µè§†åªéœ€è¦è¯»å– Y åˆ†é‡ï¼Œå½©è‰²ç”µè§†å†åŠ ä¸Š U/V åˆ†é‡ã€‚

### 2. YUV çš„ä¸‰ä¸ªåˆ†é‡

```
Yï¼ˆLuma äº®åº¦ï¼‰:
  - è¡¨ç¤ºåƒç´ çš„æ˜æš—ç¨‹åº¦ï¼ˆé»‘ â†’ ç° â†’ ç™½ï¼‰
  - èŒƒå›´ï¼šé€šå¸¸ [16, 235]ï¼ˆè§†é¢‘çº§åˆ«ï¼‰æˆ– [0, 255]ï¼ˆJPEG çº§åˆ«ï¼‰

Uï¼ˆCb è‰²åº¦è“ï¼‰:
  - è¡¨ç¤ºè“è‰²åˆ†é‡ä¸äº®åº¦çš„å·®å€¼
  - èŒƒå›´ï¼šé€šå¸¸ [16, 240]ï¼Œä¸­æ€§å€¼ 128

Vï¼ˆCr è‰²åº¦çº¢ï¼‰:
  - è¡¨ç¤ºçº¢è‰²åˆ†é‡ä¸äº®åº¦çš„å·®å€¼
  - èŒƒå›´ï¼šé€šå¸¸ [16, 240]ï¼Œä¸­æ€§å€¼ 128
```

ğŸ“Š é…å›¾ Bï¼šYUV ä¸‰åˆ†é‡ç¤ºæ„ï¼ˆAI æç¤ºè¯ï¼‰

- ä¸­æ–‡æç¤ºè¯ï¼š
  - ç™½è‰²èƒŒæ™¯ï¼Œ16:9 æ¨ªç‰ˆã€‚ä¸‰å¼ å¹¶æ’çš„å›¾åƒç¤ºæ„ï¼šå·¦ä¾§"Y äº®åº¦å¹³é¢"æ˜¾ç¤ºç°åº¦æ¢¯åº¦ï¼ˆé»‘åˆ°ç™½ï¼‰ï¼Œæ ‡æ³¨"Full Resolution å…¨åˆ†è¾¨ç‡ 1920Ã—1080"ï¼›ä¸­é—´"U è‰²åº¦å¹³é¢"æ˜¾ç¤ºè“è‰²æ¢¯åº¦ï¼ˆåè“åˆ°åé»„ï¼‰ï¼Œæ ‡æ³¨"Half Resolution åŠåˆ†è¾¨ç‡ 960Ã—540"ï¼›å³ä¾§"V è‰²åº¦å¹³é¢"æ˜¾ç¤ºçº¢è‰²æ¢¯åº¦ï¼ˆåç»¿åˆ°åçº¢ï¼‰ï¼Œæ ‡æ³¨"Half Resolution åŠåˆ†è¾¨ç‡ 960Ã—540"ã€‚ä¸‹æ–¹æ€»ç»“ï¼š"YUV420: Y å…¨å°ºå¯¸ï¼ŒU/V å„ 1/4"ã€‚
- English prompt:
  - White background, 16:9 landscape. Three side-by-side image representations: left "Y Luma Plane" shows grayscale gradient (black to white), labeled "Full Resolution å…¨åˆ†è¾¨ç‡ 1920Ã—1080"; middle "U Chroma Plane" shows blue gradient (blue-ish to yellow-ish), labeled "Half Resolution åŠåˆ†è¾¨ç‡ 960Ã—540"; right "V Chroma Plane" shows red gradient (green-ish to red-ish), labeled "Half Resolution åŠåˆ†è¾¨ç‡ 960Ã—540". Bottom summary: "YUV420: Y full size, U/V each 1/4".

---

## ğŸ“ YUV é‡‡æ ·æ ¼å¼ï¼š4:4:4 / 4:2:2 / 4:2:0

### é‡‡æ ·æ¯”ä¾‹è¯¦è§£

```
YUV444ï¼ˆæ— å‹ç¼©ï¼‰:
  - Yã€Uã€V éƒ½æ˜¯å…¨åˆ†è¾¨ç‡
  - æ¯ä¸ªåƒç´ éƒ½æœ‰ç‹¬ç«‹çš„ Y/U/V å€¼
  - æ•°æ®é‡ = RGBï¼ˆæ— èŠ‚çœï¼‰

YUV422ï¼ˆåŠå®½å‹ç¼©ï¼‰:
  - Y å…¨åˆ†è¾¨ç‡ï¼ŒU/V æ°´å¹³å‡åŠ
  - æ°´å¹³ 2 ä¸ªåƒç´ å…±äº« 1 ç»„ U/V
  - æ•°æ®é‡ = RGB Ã— 2/3ï¼ˆèŠ‚çœ 33%ï¼‰

YUV420ï¼ˆæœ€å¸¸ç”¨ï¼‰:
  - Y å…¨åˆ†è¾¨ç‡ï¼ŒU/V æ°´å¹³å’Œå‚ç›´éƒ½å‡åŠ
  - 2Ã—2 çš„ 4 ä¸ªåƒç´ å…±äº« 1 ç»„ U/V
  - æ•°æ®é‡ = RGB Ã— 1/2ï¼ˆèŠ‚çœ 50%ï¼‰
```

```mermaid
graph TB
    A[åŸå§‹åƒç´  4Ã—4 = 16 åƒç´ ] --> B{é‡‡æ ·æ ¼å¼}
    B --> C[YUV444\n16Y + 16U + 16V = 48 åˆ†é‡]
    B --> D[YUV422\n16Y + 8U + 8V = 32 åˆ†é‡]
    B --> E[YUV420\n16Y + 4U + 4V = 24 åˆ†é‡]
    
    C --> C1[æ•°æ®é‡ = RGB Ã— 1.0\næ— å‹ç¼©]
    D --> D1[æ•°æ®é‡ = RGB Ã— 0.67\nèŠ‚çœ 33%]
    E --> E1[æ•°æ®é‡ = RGB Ã— 0.5\nèŠ‚çœ 50%]
    
    style E fill:#90EE90
    style E1 fill:#90EE90
```

ğŸ“Š é…å›¾ Cï¼šYUV420 é‡‡æ ·ç¤ºæ„ï¼ˆAI æç¤ºè¯ï¼‰

- ä¸­æ–‡æç¤ºè¯ï¼š
  - åƒç´ ç½‘æ ¼å›¾ï¼Œç™½è‰²èƒŒæ™¯ï¼Œ16:9 æ¨ªç‰ˆã€‚ç”»ä¸€ä¸ª 4Ã—4 çš„åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­æ ‡æ³¨"Y"ï¼ˆæµ…ç°è‰²ï¼‰ã€‚åœ¨ç½‘æ ¼å³ä¾§ç”»ä¸€ä¸ª 2Ã—2 çš„å°ç½‘æ ¼ï¼Œæ ‡æ³¨"U"ï¼ˆæµ…è“è‰²ï¼‰å’Œ"V"ï¼ˆæµ…çº¢è‰²ï¼‰ã€‚ç”¨è™šçº¿ç®­å¤´ä»å·¦ä¾§ 2Ã—2 çš„ä¸€ç»„åƒç´ æŒ‡å‘å³ä¾§çš„ä¸€ä¸ª U/V æ ¼å­ï¼Œæ ‡æ³¨"4 åƒç´ å…±äº« 1 ç»„ U/V"ã€‚ä¸‹æ–¹æ ‡æ³¨ï¼š"YUV420: äº®åº¦å…¨é‡‡æ ·ï¼Œè‰²åº¦ 1/4 é‡‡æ · Luma full sampled, Chroma 1/4 subsampled"ã€‚
- English prompt:
  - Pixel grid diagram, white background, 16:9 landscape. Draw 4Ã—4 pixel grid, each cell labeled "Y" (light gray). Right side shows 2Ã—2 smaller grid labeled "U" (light blue) and "V" (light red). Dashed arrows from left 2Ã—2 pixel group pointing to one U/V cell on right, annotated "4 åƒç´ å…±äº« 1 ç»„ U/V 4 pixels share 1 U/V pair". Bottom note: "YUV420: äº®åº¦å…¨é‡‡æ ·ï¼Œè‰²åº¦ 1/4 é‡‡æ · Luma full sampled, Chroma 1/4 subsampled".

---

## ğŸ§® YUV åˆ° RGB çš„è½¬æ¢å…¬å¼

### 1. æ ‡å‡†è½¬æ¢çŸ©é˜µï¼ˆBT.601ï¼‰

BT.601ï¼ˆæ ‡æ¸…æ ‡å‡†ï¼‰è½¬æ¢å…¬å¼ï¼š

$$
\begin{aligned}
R &= 1.164(Y - 16) + 1.596(V - 128) \\
G &= 1.164(Y - 16) - 0.391(U - 128) - 0.813(V - 128) \\
B &= 1.164(Y - 16) + 2.018(U - 128)
\end{aligned}
$$

**çŸ©é˜µå½¢å¼**ï¼š

$$
\begin{bmatrix}
R \\
G \\
B
\end{bmatrix}
=
\begin{bmatrix}
1.164 & 0 & 1.596 \\
1.164 & -0.391 & -0.813 \\
1.164 & 2.018 & 0
\end{bmatrix}
\begin{bmatrix}
Y - 16 \\
U - 128 \\
V - 128
\end{bmatrix}
$$

### 2. é«˜æ¸…æ ‡å‡†ï¼ˆBT.709ï¼‰

BT.709ï¼ˆé«˜æ¸…æ ‡å‡†ï¼Œ1080p/4Kï¼‰è½¬æ¢å…¬å¼ï¼š

$$
\begin{aligned}
R &= 1.164(Y - 16) + 1.793(V - 128) \\
G &= 1.164(Y - 16) - 0.213(U - 128) - 0.533(V - 128) \\
B &= 1.164(Y - 16) + 2.112(U - 128)
\end{aligned}
$$

**å…³é”®åŒºåˆ«**ï¼š

```
BT.601ï¼ˆæ ‡æ¸… SDï¼Œâ‰¤576pï¼‰:
  - è‰²åŸŸè¾ƒçª„
  - ç³»æ•°ï¼šVâ†’R = 1.596, Uâ†’B = 2.018

BT.709ï¼ˆé«˜æ¸… HD/4Kï¼Œâ‰¥720pï¼‰:
  - è‰²åŸŸæ›´å®½ï¼Œè‰²å½©æ›´é²œè‰³
  - ç³»æ•°ï¼šVâ†’R = 1.793, Uâ†’B = 2.112

âš ï¸ ç”¨é”™æ ‡å‡†ä¼šå¯¼è‡´é¢œè‰²åå·®ï¼ˆåçº¢æˆ–åç»¿ï¼‰ï¼
```

### 3. JPEG æ ¼å¼çš„ç‰¹æ®Šå¤„ç†

```
JPEG/Full Range YUV:
  - Y èŒƒå›´ï¼š[0, 255]ï¼ˆä¸æ˜¯ [16, 235]ï¼‰
  - U/V èŒƒå›´ï¼š[0, 255]ï¼ˆä¸æ˜¯ [16, 240]ï¼‰

è½¬æ¢å…¬å¼ï¼ˆç®€åŒ–ï¼‰:
  R = Y + 1.402 Ã— (V - 128)
  G = Y - 0.344 Ã— (U - 128) - 0.714 Ã— (V - 128)
  B = Y + 1.772 Ã— (U - 128)
```

---

## ğŸ”„ è½¬æ¢åŸç†æ·±å…¥ï¼šä» YUV åˆ° RGB çš„æ¨å¯¼

### 1. RGB åˆ° YUV çš„æ­£å‘æ¨å¯¼

é¦–å…ˆç†è§£ YUV æ˜¯å¦‚ä½•ä» RGB äº§ç”Ÿçš„ï¼ˆç¼–ç é˜¶æ®µï¼‰ï¼š

```
æ­£å‘è½¬æ¢ï¼ˆRGB â†’ YUVï¼‰ï¼š
  Y  = 0.299Ã—R + 0.587Ã—G + 0.114Ã—B    ï¼ˆäº®åº¦åŠ æƒå’Œï¼‰
  U  = 0.492Ã—(B - Y) = -0.147Ã—R - 0.289Ã—G + 0.436Ã—B
  V  = 0.877Ã—(R - Y) =  0.615Ã—R - 0.515Ã—G - 0.100Ã—B

è®¾è®¡åŸç†ï¼š
  - Y ç³»æ•°ï¼ˆ0.299, 0.587, 0.114ï¼‰æ¨¡æ‹Ÿäººçœ¼å¯¹ RGB çš„æ•æ„Ÿåº¦
  - ç»¿è‰²ç³»æ•°æœ€å¤§ï¼ˆ0.587ï¼‰ï¼Œå› ä¸ºäººçœ¼å¯¹ç»¿è‰²æœ€æ•æ„Ÿ
  - U/V æ˜¯è‰²åº¦å·®å€¼ï¼Œä¸­æ€§è‰²ï¼ˆç°è‰²ï¼‰æ—¶ U=V=0
```

ğŸ“Š é…å›¾ Dï¼šRGB åˆ° YUV æƒé‡åˆ†è§£ï¼ˆAI æç¤ºè¯ï¼‰

- ä¸­æ–‡æç¤ºè¯ï¼š
  - ç™½è‰²èƒŒæ™¯ï¼Œ16:9 æ¨ªç‰ˆã€‚å·¦ä¾§æ˜¾ç¤ºä¸€ä¸ª RGB ç«‹æ–¹ä½“ï¼ˆçº¢ç»¿è“ä¸‰è½´ï¼‰ï¼Œå³ä¾§æ˜¾ç¤º YUV åæ ‡ç³»ã€‚ä» RGB ç«‹æ–¹ä½“çš„å¯¹è§’çº¿ï¼ˆç°åº¦è½´ï¼‰å¼•å‡ºç®­å¤´æŒ‡å‘ Y è½´ï¼Œæ ‡æ³¨"äº®åº¦åˆ†é‡ Luma 0.299R+0.587G+0.114B"ã€‚ä»ç«‹æ–¹ä½“çš„è“è‰²æ–¹å‘å¼•å‡ºç®­å¤´æŒ‡å‘ U è½´ï¼Œæ ‡æ³¨"è‰²åº¦è“ Chroma Blue (B-Y)"ã€‚ä»çº¢è‰²æ–¹å‘å¼•å‡ºç®­å¤´æŒ‡å‘ V è½´ï¼Œæ ‡æ³¨"è‰²åº¦çº¢ Chroma Red (R-Y)"ã€‚
- English prompt:
  - White background, 16:9 landscape. Left shows RGB cube (red/green/blue axes), right shows YUV coordinate system. Arrow from RGB cube diagonal (grayscale axis) to Y axis, labeled "äº®åº¦åˆ†é‡ Luma 0.299R+0.587G+0.114B". Arrow from blue direction to U axis, labeled "è‰²åº¦è“ Chroma Blue (B-Y)". Arrow from red direction to V axis, labeled "è‰²åº¦çº¢ Chroma Red (R-Y)".

### 2. é€†å‘è½¬æ¢ï¼ˆYUV â†’ RGBï¼‰æ¨å¯¼

è§£ç æ—¶éœ€è¦åå‘è®¡ç®—ï¼Œä» YUV è¿˜åŸ RGBï¼š

```
ä»æ­£å‘å…¬å¼æ¨å¯¼ï¼š
  Y  = 0.299R + 0.587G + 0.114B    ...(1)
  U  = 0.492(B - Y)                ...(2)
  V  = 0.877(R - Y)                ...(3)

ä» (2) è§£å‡º Bï¼š
  B = Y + U/0.492 = Y + 2.032U

ä» (3) è§£å‡º Rï¼š
  R = Y + V/0.877 = Y + 1.140V

å°† R å’Œ B ä»£å…¥ (1) è§£å‡º Gï¼š
  Y = 0.299(Y+1.140V) + 0.587G + 0.114(Y+2.032U)
  0.587G = Y - 0.299Y - 0.114Y - 0.341V - 0.232U
  G = Y - 0.394U - 0.581V
```

**JPEG/Full Range çš„ç®€åŒ–å…¬å¼**ï¼š

$$
\begin{aligned}
R &= Y + 1.402V \\
G &= Y - 0.344U - 0.714V \\
B &= Y + 1.772U
\end{aligned}
$$

### 3. Video Range çš„ä¿®æ­£

è§†é¢‘æ ‡å‡†ä½¿ç”¨å—é™èŒƒå›´ï¼ˆLimited Rangeï¼‰ï¼Œéœ€è¦é¢å¤–å¤„ç†ï¼š

```
Video Rangeï¼ˆBT.601/BT.709ï¼‰ï¼š
  Y  èŒƒå›´ï¼š[16, 235]ï¼ˆä¸æ˜¯ [0, 255]ï¼‰
  UV èŒƒå›´ï¼š[16, 240]ï¼Œä¸­æ€§å€¼ 128

å½’ä¸€åŒ–æ­¥éª¤ï¼š
  Y'  = (Y - 16) / 219    ï¼ˆå°† [16,235] æ˜ å°„åˆ° [0,1]ï¼‰
  U'  = (U - 128) / 224   ï¼ˆå°† [16,240] ä¸­å¿ƒåŒ–åˆ° [-0.5,0.5]ï¼‰
  V'  = (V - 128) / 224

åº”ç”¨è½¬æ¢ï¼š
  R = Y' + aV'
  G = Y' + bU' + cV'
  B = Y' + dU'

ç¼©æ”¾å› [0, 255]ï¼š
  R_final = clamp(R Ã— 255, 0, 255)
```

### è½¬æ¢æµç¨‹å›¾

```mermaid
flowchart TD
    A[YUV åŸå§‹å€¼\nY[16,235] U[16,240] V[16,240]] --> B{Range Type?}
    B -->|Video Limited| C[å½’ä¸€åŒ–\nY'=(Y-16)/219\nU'=(U-128)/224\nV'=(V-128)/224]
    B -->|Full JPEG| D[ä¸­å¿ƒåŒ–\nU'=(U-128)/255\nV'=(V-128)/255]
    C --> E{è‰²å½©æ ‡å‡†?}
    D --> E
    E -->|BT.601 SD| F[åº”ç”¨ BT.601 ç³»æ•°\nR=Y'+1.596V'\nG=Y'-0.391U'-0.813V'\nB=Y'+2.018U']
    E -->|BT.709 HD| G[åº”ç”¨ BT.709 ç³»æ•°\nR=Y'+1.793V'\nG=Y'-0.213U'-0.533V'\nB=Y'+2.112U']
    F --> H[é’³ä½åˆ° [0,255]\nClamp RGB]
    G --> H
    H --> I[è¾“å‡º RGB åƒç´ ]
```

---

## ğŸ§ª FFmpeg å‘½ä»¤å®æˆ˜ï¼šé¢œè‰²ç©ºé—´è½¬æ¢

### å®éªŒ 1ï¼šæŸ¥çœ‹è§†é¢‘çš„é¢œè‰²ç©ºé—´ä¿¡æ¯

```bash
# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
ffprobe -v error -show_streams -select_streams v input.mp4

# å…³é”®å­—æ®µï¼š
# color_space: bt709 æˆ– bt470bg (BT.601)
# color_range: tv (é™åˆ¶èŒƒå›´) æˆ– pc (å…¨èŒƒå›´)
# pix_fmt: yuv420p, yuv422p, yuv444p ç­‰
```

### å®éªŒ 2ï¼šYUV åˆ° RGB è½¬æ¢ï¼ˆCPUï¼‰

```bash
# è½¬æ¢ä¸º RGB24 æ ¼å¼ï¼ˆCPU è½¬æ¢ï¼‰
ffmpeg -i input.mp4 -pix_fmt rgb24 output_rgb.avi

# æŒ‡å®šé¢œè‰²ç©ºé—´æ ‡å‡†
ffmpeg -i input.mp4 \
  -vf "scale=in_color_matrix=bt709:out_color_matrix=bt709" \
  -pix_fmt rgb24 output.mp4
```

### å®éªŒ 3ï¼šä¸åŒæ ‡å‡†å¯¹æ¯”ï¼ˆåˆ¶é€ é¢œè‰²åå·®ï¼‰

```bash
# æ­£ç¡®ï¼šç”¨ BT.709 å¤„ç† 1080p è§†é¢‘
ffmpeg -i input_1080p.mp4 \
  -vf "scale=in_color_matrix=bt709:out_color_matrix=bt709" \
  output_correct.mp4

# é”™è¯¯ï¼šç”¨ BT.601 å¤„ç† 1080p è§†é¢‘ï¼ˆä¼šåè‰²ï¼‰
ffmpeg -i input_1080p.mp4 \
  -vf "scale=in_color_matrix=bt601:out_color_matrix=bt601" \
  output_wrong.mp4

# å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é¢œè‰²å·®å¼‚
```

### å®éªŒ 4ï¼šæå– YUV å¹³é¢æŸ¥çœ‹

```bash
# æå– Y å¹³é¢ï¼ˆç°åº¦å›¾ï¼‰
ffmpeg -i input.mp4 -vf "extractplanes=y" -pix_fmt gray output_y.png

# æå– U å¹³é¢ï¼ˆè“-é»„ï¼‰
ffmpeg -i input.mp4 -vf "extractplanes=u" -pix_fmt gray output_u.png

# æå– V å¹³é¢ï¼ˆç»¿-çº¢ï¼‰
ffmpeg -i input.mp4 -vf "extractplanes=v" -pix_fmt gray output_v.png
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆ YUV å’Œ RGB ç³»æ•°ä¼šä¸åŒï¼Ÿ

### 1. BT.601 vs BT.709 çš„è‰²å½©ç§‘å­¦

```
æ ‡å‡†å·®å¼‚çš„æ ¹æºï¼š
  - è‰²åŸŸï¼ˆColor Gamutï¼‰ï¼šå¯ä»¥è¡¨ç¤ºçš„é¢œè‰²èŒƒå›´
  - ç™½ç‚¹ï¼ˆWhite Pointï¼‰ï¼šå‚è€ƒç™½è‰²çš„å®šä¹‰ï¼ˆD65 vs D93ï¼‰
  - ä¼½é©¬æ›²çº¿ï¼ˆGammaï¼‰ï¼šéçº¿æ€§äº®åº¦æ˜ å°„

BT.601ï¼ˆ1982 å¹´ï¼Œæ ‡æ¸…æ—¶ä»£ï¼‰ï¼š
  - ä¸º CRT æ˜¾ç¤ºå™¨è®¾è®¡
  - è‰²åŸŸè¾ƒçª„ï¼Œå¯¹åº”å½“æ—¶çš„è§å…‰ç²‰ç‰¹æ€§
  - ç³»æ•°ï¼šR æƒé‡ 1.596ï¼ŒB æƒé‡ 2.018

BT.709ï¼ˆ1990 å¹´ï¼Œé«˜æ¸…æ—¶ä»£ï¼‰ï¼š
  - ä¸ºç°ä»£æ¶²æ™¶/OLED è®¾è®¡
  - è‰²åŸŸæ›´å®½ï¼Œè‰²å½©æ›´é²œè‰³
  - ç³»æ•°ï¼šR æƒé‡ 1.793ï¼ˆ+12%ï¼‰ï¼ŒB æƒé‡ 2.112ï¼ˆ+5%ï¼‰
```

ğŸ“Š é…å›¾ Eï¼šBT.601 vs BT.709 è‰²åŸŸå¯¹æ¯”ï¼ˆAI æç¤ºè¯ï¼‰

- ä¸­æ–‡æç¤ºè¯ï¼š
  - ç™½è‰²èƒŒæ™¯ï¼Œ16:9 æ¨ªç‰ˆã€‚CIE 1931 è‰²åº¦å›¾ä¸ºåº•ï¼ˆé©¬è¹„å½¢å½©è‰²åŒºåŸŸï¼‰ï¼Œå åŠ ä¸¤ä¸ªä¸‰è§’å½¢è‰²åŸŸï¼šå†…éƒ¨è¾ƒå°ä¸‰è§’å½¢æ ‡æ³¨"BT.601 è‰²åŸŸ SD Color Gamut"ï¼ˆè“è‰²è™šçº¿ï¼‰ï¼Œå¤–éƒ¨è¾ƒå¤§ä¸‰è§’å½¢æ ‡æ³¨"BT.709 è‰²åŸŸ HD Color Gamut"ï¼ˆçº¢è‰²å®çº¿ï¼‰ã€‚ä¸‰è§’å½¢é¡¶ç‚¹æ ‡æ³¨ R/G/Bã€‚ä¸­å¤®æ ‡æ³¨ç™½ç‚¹"D65"ã€‚å³ä¾§æ–‡å­—è¯´æ˜ï¼š"BT.709 è‰²åŸŸæ›´å®½ï¼Œè¦†ç›–æ›´å¤šé¥±å’Œè‰²å½© Wider gamut, more saturated colors"ã€‚
- English prompt:
  - White background, 16:9 landscape. CIE 1931 chromaticity diagram as background (horseshoe colored area), overlaid with two triangular gamuts: inner smaller triangle labeled "BT.601 è‰²åŸŸ SD Color Gamut" (blue dashed), outer larger triangle labeled "BT.709 è‰²åŸŸ HD Color Gamut" (red solid). Triangle vertices labeled R/G/B. Center marked "D65 white point". Right text: "BT.709 è‰²åŸŸæ›´å®½ï¼Œè¦†ç›–æ›´å¤šé¥±å’Œè‰²å½© Wider gamut, more saturated colors".

### 2. å®é™…è‰²å·®æ¡ˆä¾‹

```
æµ‹è¯•ç”¨ä¾‹ï¼šçº¯çº¢è‰²åƒç´ 
  RGB = (255, 0, 0)

ç”¨ BT.601 ç¼–ç å†ç”¨ BT.709 è§£ç ï¼š
  ç¼–ç ï¼ˆ601ï¼‰: Y=76, U=85, V=255
  è§£ç ï¼ˆ709ï¼‰: R=255Ã—1.122=286 â†’ clamp(286)=255 âŒ è¿‡é¥±å’Œï¼
                G= è´Ÿå€¼ â†’ clamp=0
                B= è´Ÿå€¼ â†’ clamp=0
  
ç»“æœï¼šçº¢è‰²ä¼šæ˜¾å¾—"è¿‡æ›"ï¼Œå¤±å»å±‚æ¬¡

ç”¨ BT.709 ç¼–ç å†ç”¨ BT.601 è§£ç ï¼š
  ç¼–ç ï¼ˆ709ï¼‰: Y=76, U=85, V=255
  è§£ç ï¼ˆ601ï¼‰: R=255Ã—0.89=227 âŒ ä¸é¥±å’Œï¼
  
ç»“æœï¼šçº¢è‰²ä¼šæ˜¾å¾—"å‘ç°"ï¼Œä¸é²œè‰³
```

---

## ğŸ› ï¸ ç®€å• API ç¤ºä¾‹ï¼šlibswscale è½¬æ¢

### æœ€å°ä»£ç ç¤ºä¾‹ï¼ˆCï¼‰

```c
#include <libswscale/swscale.h>
#include <libavutil/frame.h>
#include <libavutil/imgutils.h>

// åˆ›å»ºè½¬æ¢ä¸Šä¸‹æ–‡
struct SwsContext* create_yuv_to_rgb_converter(
    int width, int height,
    enum AVPixelFormat src_fmt,  // AV_PIX_FMT_YUV420P
    enum AVPixelFormat dst_fmt)  // AV_PIX_FMT_RGB24
{
    struct SwsContext *sws = sws_getContext(
        width, height, src_fmt,      // æºå‚æ•°
        width, height, dst_fmt,      // ç›®æ ‡å‚æ•°
        SWS_BILINEAR,                // ç¼©æ”¾ç®—æ³•
        NULL, NULL, NULL
    );
    
    // è®¾ç½®é¢œè‰²ç©ºé—´æ ‡å‡†ï¼ˆBT.709ï¼‰
    int colorspace = SWS_CS_ITU709;  // æˆ– SWS_CS_ITU601
    int srcRange = 0;  // 0=limited (16-235), 1=full (0-255)
    int dstRange = 1;  // RGB é€šå¸¸æ˜¯ full range
    
    sws_setColorspaceDetails(sws,
        sws_getCoefficients(colorspace), srcRange,  // æº
        sws_getCoefficients(colorspace), dstRange,  // ç›®æ ‡
        0, 1 << 16, 1 << 16);
    
    return sws;
}

// è½¬æ¢ä¸€å¸§
void convert_yuv_to_rgb(struct SwsContext *sws, AVFrame *yuv_frame, AVFrame *rgb_frame)
{
    // æ‰§è¡Œè½¬æ¢
    sws_scale(sws,
        (const uint8_t * const*)yuv_frame->data,  // æºæ•°æ®
        yuv_frame->linesize,                      // æºæ­¥é•¿
        0, yuv_frame->height,                     // èµ·å§‹è¡Œå’Œé«˜åº¦
        rgb_frame->data,                          // ç›®æ ‡æ•°æ®
        rgb_frame->linesize);                     // ç›®æ ‡æ­¥é•¿
}

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    int width = 1920, height = 1080;
    
    // åˆ›å»ºè½¬æ¢å™¨
    struct SwsContext *sws = create_yuv_to_rgb_converter(
        width, height,
        AV_PIX_FMT_YUV420P,  // YUV420P è¾“å…¥
        AV_PIX_FMT_RGB24     // RGB24 è¾“å‡º
    );
    
    // åˆ†é…å¸§
    AVFrame *yuv_frame = av_frame_alloc();
    AVFrame *rgb_frame = av_frame_alloc();
    
    yuv_frame->format = AV_PIX_FMT_YUV420P;
    yuv_frame->width = width;
    yuv_frame->height = height;
    av_frame_get_buffer(yuv_frame, 0);
    
    rgb_frame->format = AV_PIX_FMT_RGB24;
    rgb_frame->width = width;
    rgb_frame->height = height;
    av_frame_get_buffer(rgb_frame, 0);
    
    // è½¬æ¢ï¼ˆå‡è®¾ yuv_frame å·²å¡«å……æ•°æ®ï¼‰
    convert_yuv_to_rgb(sws, yuv_frame, rgb_frame);
    
    // æ¸…ç†
    sws_freeContext(sws);
    av_frame_free(&yuv_frame);
    av_frame_free(&rgb_frame);
    
    return 0;
}
```

### å…³é”® API è¯´æ˜

| API | ä½œç”¨ |
|-----|------|
| `sws_getContext()` | åˆ›å»ºé¢œè‰²ç©ºé—´/åˆ†è¾¨ç‡è½¬æ¢ä¸Šä¸‹æ–‡ |
| `sws_setColorspaceDetails()` | è®¾ç½® BT.601/BT.709 å’Œ Range |
| `sws_scale()` | æ‰§è¡Œè½¬æ¢ï¼ˆCPU é€åƒç´ ï¼‰ |
| `sws_getCoefficients()` | è·å–æ ‡å‡†è½¬æ¢ç³»æ•° |
| `sws_freeContext()` | é‡Šæ”¾èµ„æº |

---

## ğŸ§  æ€è€ƒé¢˜

1. **ä¸ºä»€ä¹ˆ YUV420 èƒ½èŠ‚çœ 50% ç©ºé—´ï¼Œä½†ç”»è´¨æ²¡æœ‰æ˜æ˜¾ä¸‹é™ï¼Ÿ**  
   <details>
   <summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>
   
   äººçœ¼å¯¹è‰²å½©ç»†èŠ‚ä¸æ•æ„Ÿï¼ˆè‰²å½©åˆ†è¾¨ç‡åªæœ‰äº®åº¦çš„ 1/3ï¼‰ï¼Œé™ä½è‰²åº¦é‡‡æ ·ç‡ä¸ä¼šè¢«å¯Ÿè§‰ã€‚è€Œä¸”è‡ªç„¶å›¾åƒçš„è‰²å½©å˜åŒ–é€šå¸¸æ¯”è¾ƒå¹³ç¼“ï¼Œ2Ã—2 åƒç´ å…±äº«è‰²åº¦ä¸ä¼šäº§ç”Ÿæ˜æ˜¾è‰²å—ã€‚
   </details>

2. **å¦‚æœç”¨ BT.601 æ ‡å‡†å¤„ç† 1080p è§†é¢‘ä¼šæ€æ ·ï¼Ÿ**  
   <details>
   <summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>
   
   ä¼šå‡ºç°é¢œè‰²åå·®ï¼šçº¢è‰²å¯èƒ½åæ©™ï¼Œè“è‰²å¯èƒ½åé’ã€‚å› ä¸º BT.601 çš„è‰²åŸŸæ›´çª„ï¼Œç”¨åœ¨é«˜æ¸…è§†é¢‘ä¸Šä¼šå‹ç¼©é¢œè‰²èŒƒå›´ï¼Œå¯¼è‡´é¢œè‰²ä¸å‡†ç¡®ã€‚
   </details>

3. **ä¸ºä»€ä¹ˆè§†é¢‘æ ‡å‡†è¦ç”¨å—é™èŒƒå›´ï¼ˆ16-235ï¼‰è€Œä¸æ˜¯å…¨èŒƒå›´ï¼ˆ0-255ï¼‰ï¼Ÿ**  
   <details>
   <summary>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>
   
   å†å²åŸå› ï¼šæ¨¡æ‹Ÿç”µè§†æ—¶ä»£éœ€è¦ç•™"ä½™é‡"é˜²æ­¢ä¿¡å·è¿‡å†²å’ŒåŒæ­¥ä¿¡å·å¹²æ‰°ã€‚16 ä»¥ä¸‹å’Œ 235 ä»¥ä¸Šé¢„ç•™ç»™åŒæ­¥è„‰å†²ã€‚æ•°å­—æ—¶ä»£ä¿ç•™è¿™ä¸€æƒ¯ä¾‹æ˜¯ä¸ºäº†å…¼å®¹ï¼Œä½† JPEG ç­‰è®¡ç®—æœºå›¾åƒæ ¼å¼ä½¿ç”¨å…¨èŒƒå›´ï¼ˆ0-255ï¼‰ã€‚
   </details>

---

## ğŸ“š æœ¬ç¯‡æ€»ç»“

### æ ¸å¿ƒçŸ¥è¯†ç‚¹

1. **YUV çš„æœ¬è´¨**ï¼š
   - åˆ†ç¦»äº®åº¦ï¼ˆYï¼‰å’Œè‰²åº¦ï¼ˆU/Vï¼‰
   - åˆ©ç”¨äººçœ¼ç‰¹æ€§ï¼Œè‰²åº¦é™é‡‡æ ·èŠ‚çœç©ºé—´
   - YUV420 æœ€å¸¸ç”¨ï¼ˆèŠ‚çœ 50%ï¼‰

2. **è½¬æ¢åŸç†**ï¼š
   - RGB â†’ YUVï¼šäº®åº¦åŠ æƒ + è‰²åº¦å·®å€¼
   - YUV â†’ RGBï¼šçŸ©é˜µé€†è¿ç®— + èŒƒå›´å½’ä¸€åŒ–
   - BT.601ï¼ˆæ ‡æ¸…ï¼‰vs BT.709ï¼ˆé«˜æ¸…ï¼‰ç³»æ•°å·®å¼‚
   - ç”¨é”™æ ‡å‡†ä¼šå¯¼è‡´é¢œè‰²åå·®ï¼ˆè¿‡é¥±å’Œæˆ–å‘ç°ï¼‰

3. **è‰²å½©ç§‘å­¦**ï¼š
   - è‰²åŸŸå†³å®šç³»æ•°ï¼šBT.709 è¦†ç›–æ›´å¹¿è‰²å½©ç©ºé—´
   - Video Rangeï¼ˆ16-235ï¼‰vs Full Rangeï¼ˆ0-255ï¼‰
   - ç™½ç‚¹å’Œä¼½é©¬æ›²çº¿å½±å“æœ€ç»ˆæ˜¾ç¤ºæ•ˆæœ

4. **FFmpeg å®æˆ˜**ï¼š
   - æŸ¥çœ‹é¢œè‰²ç©ºé—´ï¼š`ffprobe`
   - è½¬æ¢æ ¼å¼ï¼š`-pix_fmt rgb24`
   - æŒ‡å®šæ ‡å‡†ï¼š`scale=in_color_matrix=bt709`

### é…å›¾æ±‡æ€»

- ğŸ“Š RGB vs YUV å­˜å‚¨å¯¹æ¯”ï¼ˆAI æç¤ºè¯ï¼‰
- ğŸ“Š YUV ä¸‰åˆ†é‡å¹³é¢ç¤ºæ„ï¼ˆAI æç¤ºè¯ï¼‰
- ğŸ“Š YUV420 é‡‡æ ·æ¨¡å¼è¯¦è§£ï¼ˆAI æç¤ºè¯ï¼‰
- ğŸ“Š RGB åˆ° YUV æƒé‡åˆ†è§£ï¼ˆAI æç¤ºè¯ï¼‰
- ğŸ“Š BT.601 vs BT.709 è‰²åŸŸå¯¹æ¯”ï¼ˆAI æç¤ºè¯ï¼‰
- ğŸ”„ YUV é‡‡æ ·æ ¼å¼å¯¹æ¯”æ ‘ï¼ˆMermaidï¼‰
- ğŸ”„ YUV åˆ° RGB è½¬æ¢æµç¨‹ï¼ˆMermaidï¼‰

---

## ğŸš€ ä¸‹ä¸€ç¯‡é¢„å‘Š

**15ï¼ˆä¸‹ï¼‰è§†é¢‘æ¸²æŸ“åŸºç¡€ï¼šZenPlay çš„ D3D11Renderer å®ç°è¯¦è§£**

å°†æ·±å…¥è®²è§£ï¼š
- `D3D11Renderer` çš„çº¹ç†ç®¡ç†ä¸ SRV æ± 
- Pixel Shader çš„åŠ¨æ€ç¼–è¯‘ä¸ç¼“å­˜
- é›¶æ‹·è´è·¯å¾„ï¼šç¡¬è§£ â†’ GPU çº¹ç† â†’ æ¸²æŸ“
- BT.601/BT.709 çš„è‡ªåŠ¨æ£€æµ‹ä¸åˆ‡æ¢
- æ€§èƒ½ä¼˜åŒ–ï¼šçº¹ç†æ± ã€å¸¸é‡ç¼“å†²å¤ç”¨
- å®é™…æ¸²æŸ“æ—¥å¿—åˆ†æ

---

> ä½œè€…ï¼šZenPlay å›¢é˜Ÿ  
> æ›´æ–°æ—¶é—´ï¼š2025-01-27  
> ä¸“æ åœ°å€ï¼š[éŸ³è§†é¢‘å¼€å‘å…¥é—¨ä¸“æ ](../av_column_plan.md)  
> ä¸Šä¸€ç¯‡ï¼š[14. éŸ³é¢‘å¡é¡¿æ’æŸ¥ï¼šä¸ºä½•çˆ†éŸ³æ–­éŸ³](14_audio_playback_issues.md)  
> ä¸‹ä¸€ç¯‡ï¼š15ï¼ˆä¸‹ï¼‰è§†é¢‘æ¸²æŸ“åŸºç¡€ï¼šZenPlay çš„ D3D11Renderer å®ç°è¯¦è§£
