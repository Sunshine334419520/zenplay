# ZenPlay åŠŸèƒ½å®Œå–„å»ºè®®

> æ–‡æ¡£ç‰ˆæœ¬: 1.0  
> åˆ›å»ºæ—¥æœŸ: 2024-12-19  
> æœ€åæ›´æ–°: 2024-12-19

æœ¬æ–‡æ¡£åˆ—å‡ºäº† ZenPlay é¡¹ç›®å¯ä»¥å®Œå–„å’Œæ‰©å±•çš„åŠŸèƒ½ç‰¹æ€§ï¼ŒæŒ‰ç…§ç”¨æˆ·ä½“éªŒä»·å€¼å’Œå®ç°éš¾åº¦åˆ†ç±»ï¼Œä¸ºåç»­åŠŸèƒ½å¼€å‘æä¾›æ–¹å‘ã€‚

---

## ğŸ“‹ ç›®å½•

- [ä¼˜å…ˆçº§è¯´æ˜](#ä¼˜å…ˆçº§è¯´æ˜)
- [æ’­æ”¾å¢å¼º](#æ’­æ”¾å¢å¼º)
  - [P0 - åŸºç¡€å¿…å¤‡åŠŸèƒ½](#p0---åŸºç¡€å¿…å¤‡åŠŸèƒ½)
  - [P1 - é‡è¦ä½“éªŒåŠŸèƒ½](#p1---é‡è¦ä½“éªŒåŠŸèƒ½)
  - [P2 - é«˜çº§æ’­æ”¾åŠŸèƒ½](#p2---é«˜çº§æ’­æ”¾åŠŸèƒ½)
- [ç”¨æˆ·ç•Œé¢](#ç”¨æˆ·ç•Œé¢)
  - [P0 - UI åŸºç¡€å®Œå–„](#p0---ui-åŸºç¡€å®Œå–„)
  - [P1 - UI ä½“éªŒä¼˜åŒ–](#p1---ui-ä½“éªŒä¼˜åŒ–)
  - [P2 - UI é«˜çº§åŠŸèƒ½](#p2---ui-é«˜çº§åŠŸèƒ½)
- [åª’ä½“å¤„ç†](#åª’ä½“å¤„ç†)
  - [P1 - å­—å¹•æ”¯æŒ](#p1---å­—å¹•æ”¯æŒ)
  - [P1 - éŸ³é¢‘å¢å¼º](#p1---éŸ³é¢‘å¢å¼º)
  - [P2 - è§†é¢‘æ•ˆæœ](#p2---è§†é¢‘æ•ˆæœ)
- [å·¥å…·åŠŸèƒ½](#å·¥å…·åŠŸèƒ½)
  - [P1 - æˆªå›¾å’Œå½•åˆ¶](#p1---æˆªå›¾å’Œå½•åˆ¶)
  - [P2 - é«˜çº§å·¥å…·](#p2---é«˜çº§å·¥å…·)
- [ç³»ç»ŸåŠŸèƒ½](#ç³»ç»ŸåŠŸèƒ½)
- [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## ä¼˜å…ˆçº§è¯´æ˜

| ä¼˜å…ˆçº§ | è¯´æ˜ | ç”¨æˆ·ä»·å€¼ | å»ºè®®æ—¶é—´ |
|--------|------|---------|---------|
| **P0** | åŸºç¡€å¿…å¤‡åŠŸèƒ½ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒ | æé«˜ | ç«‹å³å¼€å‘ |
| **P1** | é‡è¦åŠŸèƒ½ï¼Œæ˜æ˜¾æå‡ç”¨æˆ·ä½“éªŒ | é«˜ | è¿‘æœŸå®Œæˆ |
| **P2** | é«˜çº§åŠŸèƒ½ï¼Œé”¦ä¸Šæ·»èŠ± | ä¸­ç­‰ | é•¿æœŸè§„åˆ’ |

---

## æ’­æ”¾å¢å¼º

### P0 - åŸºç¡€å¿…å¤‡åŠŸèƒ½

#### 1. ğŸµ æ’­æ”¾åˆ—è¡¨ç®¡ç†

**åŠŸèƒ½æè¿°**:
- æ”¯æŒåˆ›å»ºã€ä¿å­˜ã€åŠ è½½æ’­æ”¾åˆ—è¡¨
- æ”¯æŒæ‹–æ‹½æ’åºã€æ·»åŠ /åˆ é™¤æ–‡ä»¶
- æ˜¾ç¤ºå½“å‰æ’­æ”¾é¡¹ï¼Œé«˜äº®æ ‡è®°
- æ”¯æŒå¾ªç¯æ¨¡å¼ï¼ˆå•æ›²å¾ªç¯ã€åˆ—è¡¨å¾ªç¯ã€éšæœºæ’­æ”¾ï¼‰

**ç”¨æˆ·åœºæ™¯**:
- è¿ç»­æ’­æ”¾å¤šä¸ªè§†é¢‘æ–‡ä»¶
- åˆ›å»ºä¸´æ—¶æ’­æ”¾åˆ—è¡¨è§‚çœ‹å‰§é›†
- ä¿å­˜å¸¸ç”¨æ’­æ”¾åˆ—è¡¨ï¼ˆå¦‚æ•™å­¦è§†é¢‘ã€éŸ³ä¹åˆé›†ï¼‰

**å®ç°æ–¹æ¡ˆ**:

```cpp
// playlist_manager.h
class PlaylistManager {
 public:
  struct PlaylistItem {
    std::string file_path;
    std::string title;
    int64_t duration_ms;
    QPixmap thumbnail;  // å¯é€‰ï¼šç¼©ç•¥å›¾
  };

  enum class PlayMode {
    SEQUENTIAL,  // é¡ºåºæ’­æ”¾
    LOOP_ONE,    // å•æ›²å¾ªç¯
    LOOP_ALL,    // åˆ—è¡¨å¾ªç¯
    SHUFFLE      // éšæœºæ’­æ”¾
  };

  // æ’­æ”¾åˆ—è¡¨æ“ä½œ
  void AddItem(const PlaylistItem& item);
  void RemoveItem(size_t index);
  void MoveItem(size_t from, size_t to);
  void Clear();

  // æ’­æ”¾æ§åˆ¶
  bool Next();
  bool Previous();
  void SetPlayMode(PlayMode mode);
  void SetCurrentIndex(size_t index);

  // æŒä¹…åŒ–
  bool SaveToFile(const std::string& filepath);
  bool LoadFromFile(const std::string& filepath);

  // ä¿¡å·é€šçŸ¥
  using OnPlaylistChangedCallback = std::function<void()>;
  using OnCurrentItemChangedCallback = std::function<void(size_t)>;

  void RegisterPlaylistChangedCallback(OnPlaylistChangedCallback cb);
  void RegisterCurrentItemChangedCallback(OnCurrentItemChangedCallback cb);

 private:
  std::vector<PlaylistItem> items_;
  size_t current_index_ = 0;
  PlayMode play_mode_ = PlayMode::SEQUENTIAL;
  std::vector<size_t> shuffle_order_;  // éšæœºæ’­æ”¾é¡ºåº
};
```

**UI è®¾è®¡**:
```cpp
// playlist_widget.h
class PlaylistWidget : public QWidget {
  Q_OBJECT

 public:
  PlaylistWidget(PlaylistManager* manager, QWidget* parent = nullptr);

 private slots:
  void onItemDoubleClicked(const QModelIndex& index);
  void onAddFiles();
  void onRemoveSelected();
  void onClearAll();
  void onSavePlaylist();
  void onLoadPlaylist();
  void onPlayModeChanged();

 private:
  void setupUI();
  void updatePlaylist();

  PlaylistManager* playlist_manager_;
  QListWidget* list_widget_;
  QPushButton* add_btn_;
  QPushButton* remove_btn_;
  QPushButton* clear_btn_;
  QComboBox* play_mode_combo_;
};
```

**æ’­æ”¾åˆ—è¡¨æ ¼å¼ (JSON)**:
```json
{
  "name": "My Playlist",
  "version": "1.0",
  "play_mode": "sequential",
  "items": [
    {
      "path": "/path/to/video1.mp4",
      "title": "Episode 1",
      "duration_ms": 1234567
    },
    {
      "path": "/path/to/video2.mp4",
      "title": "Episode 2",
      "duration_ms": 2345678
    }
  ]
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•-ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­â­ (æé«˜)

---

#### 2. â© å€é€Ÿæ’­æ”¾

**åŠŸèƒ½æè¿°**:
- æ”¯æŒ 0.25x - 4.0x å€é€Ÿæ’­æ”¾
- å¸¸ç”¨å€é€Ÿé¢„è®¾ï¼ˆ0.5x, 0.75x, 1.0x, 1.25x, 1.5x, 2.0xï¼‰
- ä¿æŒéŸ³è°ƒä¸å˜ï¼ˆä½¿ç”¨ SoundTouch æˆ– FFmpeg çš„ atempo æ»¤é•œï¼‰

**ç”¨æˆ·åœºæ™¯**:
- å¿«é€Ÿé¢„è§ˆè§†é¢‘å†…å®¹
- æ…¢é€Ÿæ’­æ”¾å­¦ä¹ å¤æ‚å†…å®¹
- åŠ é€Ÿè§‚çœ‹æ•™å­¦è§†é¢‘

**å®ç°æ–¹æ¡ˆ**:

```cpp
// playback_controller.h
class PlaybackController {
 public:
  void SetPlaybackSpeed(float speed);  // 0.25 - 4.0
  float GetPlaybackSpeed() const;

 private:
  void ApplySpeedToAudio(float speed);
  void ApplySpeedToVideo(float speed);

  float playback_speed_ = 1.0f;
};
```

**éŸ³é¢‘å˜é€Ÿå®ç° (ä½¿ç”¨ FFmpeg atempo æ»¤é•œ)**:
```cpp
void AudioPlayer::SetPlaybackSpeed(float speed) {
  if (speed < 0.5f || speed > 2.0f) {
    // atempo æ»¤é•œé™åˆ¶ 0.5-2.0ï¼Œéœ€è¦çº§è”
    // ä¾‹å¦‚ 4.0x = 2.0x * 2.0x
    MODULE_WARN(LOG_MODULE_AUDIO, 
                "Speed {} requires filter chain", speed);
    // å®ç°çº§è”æ»¤é•œ...
  }

  // åˆ›å»º atempo æ»¤é•œ
  char filter_desc[256];
  snprintf(filter_desc, sizeof(filter_desc), "atempo=%.2f", speed);

  AVFilterGraph* filter_graph = avfilter_graph_alloc();
  AVFilterContext* buffersrc_ctx;
  AVFilterContext* buffersink_ctx;

  // é…ç½® buffer source
  const AVFilter* buffersrc = avfilter_get_by_name("abuffer");
  char args[512];
  snprintf(args, sizeof(args),
           "time_base=1/%d:sample_rate=%d:sample_fmt=%s:channel_layout=0x%" PRIx64,
           audio_spec_.sample_rate, audio_spec_.sample_rate,
           av_get_sample_fmt_name(AV_SAMPLE_FMT_FLT),
           av_get_default_channel_layout(audio_spec_.channels));

  avfilter_graph_create_filter(&buffersrc_ctx, buffersrc, "in",
                                args, nullptr, filter_graph);

  // é…ç½® buffer sink
  const AVFilter* buffersink = avfilter_get_by_name("abuffersink");
  avfilter_graph_create_filter(&buffersink_ctx, buffersink, "out",
                                nullptr, nullptr, filter_graph);

  // åˆ›å»º atempo æ»¤é•œ
  AVFilterContext* atempo_ctx;
  const AVFilter* atempo_filter = avfilter_get_by_name("atempo");
  avfilter_graph_create_filter(&atempo_ctx, atempo_filter, "atempo",
                                filter_desc, nullptr, filter_graph);

  // è¿æ¥æ»¤é•œ
  avfilter_link(buffersrc_ctx, 0, atempo_ctx, 0);
  avfilter_link(atempo_ctx, 0, buffersink_ctx, 0);

  // é…ç½®å›¾
  avfilter_graph_config(filter_graph, nullptr);

  // ä¿å­˜æ»¤é•œå›¾
  audio_filter_graph_ = filter_graph;
  audio_buffersrc_ctx_ = buffersrc_ctx;
  audio_buffersink_ctx_ = buffersink_ctx;
}

void AudioPlayer::ProcessFrameWithFilter(AVFrame* input_frame, 
                                         AVFrame** output_frame) {
  // æ¨é€å¸§åˆ°æ»¤é•œ
  av_buffersrc_add_frame_flags(audio_buffersrc_ctx_, input_frame, 
                               AV_BUFFERSRC_FLAG_KEEP_REF);

  // ä»æ»¤é•œè·å–å¤„ç†åçš„å¸§
  AVFrame* filtered_frame = av_frame_alloc();
  int ret = av_buffersink_get_frame(audio_buffersink_ctx_, filtered_frame);
  
  if (ret >= 0) {
    *output_frame = filtered_frame;
  }
}
```

**è§†é¢‘å˜é€Ÿå®ç° (è°ƒæ•´å¸§é—´éš”)**:
```cpp
void VideoPlayer::SetPlaybackSpeed(float speed) {
  playback_speed_ = speed;
  
  // è°ƒæ•´å¸§æ˜¾ç¤ºé—´éš”
  // åŸå§‹å¸§ç‡ 30fps -> 33.33ms/å¸§
  // 2.0x å€é€Ÿ -> 16.67ms/å¸§
  // 0.5x å€é€Ÿ -> 66.67ms/å¸§
}

void VideoPlayer::RenderLoop() {
  while (running_) {
    auto delay = CalculateVideoDelay(...);
    
    // åº”ç”¨å€é€Ÿè°ƒæ•´
    delay /= playback_speed_;  // âœ… å€é€Ÿæ’­æ”¾
    
    if (delay > 0) {
      std::this_thread::sleep_for(
          std::chrono::milliseconds(static_cast<int>(delay)));
    }
    
    RenderFrame();
  }
}
```

**UI æ§ä»¶**:
```cpp
// main_window.cpp
void MainWindow::setupControlBar() {
  // å€é€Ÿé€‰æ‹©ä¸‹æ‹‰æ¡†
  speed_combo_ = new QComboBox(this);
  speed_combo_->addItem("0.25x", 0.25f);
  speed_combo_->addItem("0.5x", 0.5f);
  speed_combo_->addItem("0.75x", 0.75f);
  speed_combo_->addItem("1.0x (Normal)", 1.0f);
  speed_combo_->addItem("1.25x", 1.25f);
  speed_combo_->addItem("1.5x", 1.5f);
  speed_combo_->addItem("2.0x", 2.0f);
  speed_combo_->addItem("4.0x", 4.0f);
  speed_combo_->setCurrentIndex(3);  // é»˜è®¤ 1.0x

  connect(speed_combo_, QOverload<int>::of(&QComboBox::currentIndexChanged),
          this, &MainWindow::onSpeedChanged);
}

void MainWindow::onSpeedChanged(int index) {
  float speed = speed_combo_->itemData(index).toFloat();
  player_->SetPlaybackSpeed(speed);
}
```

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­â­ (æé«˜)

---

### P1 - é‡è¦ä½“éªŒåŠŸèƒ½

#### 3. â­ï¸ å¿«è¿›/å¿«é€€æ­¥è¿›æ§åˆ¶

**åŠŸèƒ½æè¿°**:
- æ”¯æŒå›ºå®šæ­¥é•¿è·³è½¬ï¼ˆ5ç§’ã€10ç§’ã€30ç§’ã€1åˆ†é’Ÿï¼‰
- é”®ç›˜å¿«æ·é”®ï¼ˆå·¦ç®­å¤´åé€€ 5ç§’ï¼Œå³ç®­å¤´å‰è¿› 5ç§’ï¼‰
- é¼ æ ‡æ»šè½®å¾®è°ƒï¼ˆæ»šåŠ¨å‰è¿›/åé€€ 1ç§’ï¼‰

**å®ç°æ–¹æ¡ˆ**:

```cpp
// main_window.cpp
void MainWindow::setupShortcuts() {
  // å¿«è¿›/å¿«é€€å¿«æ·é”®
  auto* skip_forward_5s = new QShortcut(Qt::Key_Right, this);
  connect(skip_forward_5s, &QShortcut::activated, 
          this, [this]() { skipTime(5000); });

  auto* skip_backward_5s = new QShortcut(Qt::Key_Left, this);
  connect(skip_backward_5s, &QShortcut::activated, 
          this, [this]() { skipTime(-5000); });

  auto* skip_forward_30s = new QShortcut(Qt::CTRL + Qt::Key_Right, this);
  connect(skip_forward_30s, &QShortcut::activated, 
          this, [this]() { skipTime(30000); });

  auto* skip_backward_30s = new QShortcut(Qt::CTRL + Qt::Key_Left, this);
  connect(skip_backward_30s, &QShortcut::activated, 
          this, [this]() { skipTime(-30000); });

  // é¼ æ ‡æ»šè½®æ§åˆ¶
  video_display_->installEventFilter(this);
}

bool MainWindow::eventFilter(QObject* obj, QEvent* event) {
  if (obj == video_display_ && event->type() == QEvent::Wheel) {
    QWheelEvent* wheel_event = static_cast<QWheelEvent*>(event);
    int delta = wheel_event->angleDelta().y();
    
    if (delta > 0) {
      skipTime(1000);   // å‰è¿› 1 ç§’
    } else {
      skipTime(-1000);  // åé€€ 1 ç§’
    }
    
    return true;  // äº‹ä»¶å·²å¤„ç†
  }
  
  return QMainWindow::eventFilter(obj, event);
}

void MainWindow::skipTime(int64_t offset_ms) {
  int64_t current_time = player_->GetCurrentPlayTime();
  int64_t duration = player_->GetDuration();
  int64_t target_time = std::clamp(current_time + offset_ms, 
                                   0LL, duration);
  
  player_->SeekAsync(target_time);
  
  // æ˜¾ç¤ºä¸´æ—¶æç¤º (OSD)
  showOSD(QString("%1%2s")
          .arg(offset_ms > 0 ? "+" : "")
          .arg(offset_ms / 1000.0, 0, 'f', 1));
}

void MainWindow::showOSD(const QString& text) {
  // åˆ›å»ºåŠé€æ˜æç¤ºæ¡†
  if (!osd_label_) {
    osd_label_ = new QLabel(video_display_);
    osd_label_->setStyleSheet(
        "background-color: rgba(0, 0, 0, 180);"
        "color: white;"
        "font-size: 24px;"
        "padding: 10px 20px;"
        "border-radius: 5px;");
    osd_label_->setAlignment(Qt::AlignCenter);
  }

  osd_label_->setText(text);
  osd_label_->adjustSize();
  
  // å±…ä¸­æ˜¾ç¤º
  int x = (video_display_->width() - osd_label_->width()) / 2;
  int y = (video_display_->height() - osd_label_->height()) / 2;
  osd_label_->move(x, y);
  osd_label_->show();

  // 2 ç§’åè‡ªåŠ¨éšè—
  QTimer::singleShot(2000, osd_label_, &QLabel::hide);
}
```

**å®æ–½éš¾åº¦**: â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 2 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

#### 4. ğŸ“Œ ä¹¦ç­¾/æ ‡è®°åŠŸèƒ½

**åŠŸèƒ½æè¿°**:
- åœ¨è§†é¢‘ä¸­æ·»åŠ ä¹¦ç­¾æ ‡è®°
- å¿«é€Ÿè·³è½¬åˆ°ä¹¦ç­¾ä½ç½®
- ä¿å­˜ä¹¦ç­¾åˆ°æ–‡ä»¶ï¼Œä¸‹æ¬¡æ‰“å¼€è‡ªåŠ¨åŠ è½½

**ç”¨æˆ·åœºæ™¯**:
- æ ‡è®°è§†é¢‘ä¸­çš„ç²¾å½©ç‰‡æ®µ
- å­¦ä¹ è§†é¢‘æ—¶æ ‡è®°é‡ç‚¹ä½ç½®
- é•¿è§†é¢‘ä¸­å¿«é€Ÿå®šä½

**å®ç°æ–¹æ¡ˆ**:

```cpp
// bookmark_manager.h
class BookmarkManager {
 public:
  struct Bookmark {
    int64_t timestamp_ms;
    std::string title;
    std::string description;
    QPixmap thumbnail;  // å¯é€‰
  };

  void AddBookmark(const Bookmark& bookmark);
  void RemoveBookmark(size_t index);
  const std::vector<Bookmark>& GetBookmarks() const;

  bool SaveToFile(const std::string& video_path);
  bool LoadFromFile(const std::string& video_path);

 private:
  std::vector<Bookmark> bookmarks_;
};
```

**UI æ§ä»¶**:
```cpp
// bookmark_widget.h
class BookmarkWidget : public QWidget {
  Q_OBJECT

 public:
  BookmarkWidget(BookmarkManager* manager, QWidget* parent = nullptr);

 signals:
  void bookmarkSelected(int64_t timestamp_ms);

 private slots:
  void onAddBookmark();
  void onRemoveBookmark();
  void onBookmarkClicked(const QModelIndex& index);

 private:
  BookmarkManager* bookmark_manager_;
  QListWidget* bookmark_list_;
};
```

**å­˜å‚¨æ ¼å¼ (JSON)**:
```json
{
  "video_path": "/path/to/video.mp4",
  "bookmarks": [
    {
      "timestamp_ms": 12345,
      "title": "ç²¾å½©ç‰‡æ®µ",
      "description": "ä¸»è§’ç™»åœº"
    },
    {
      "timestamp_ms": 67890,
      "title": "é‡ç‚¹å†…å®¹",
      "description": "ç®—æ³•è®²è§£"
    }
  ]
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

### P2 - é«˜çº§æ’­æ”¾åŠŸèƒ½

#### 5. ğŸ”Š éŸ³é¢‘è½¨é“åˆ‡æ¢

**åŠŸèƒ½æè¿°**:
- æ£€æµ‹è§†é¢‘ä¸­çš„å¤šä¸ªéŸ³é¢‘è½¨é“
- åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­åŠ¨æ€åˆ‡æ¢éŸ³è½¨
- æ˜¾ç¤ºéŸ³è½¨ä¿¡æ¯ï¼ˆè¯­è¨€ã€ç¼–ç ã€å£°é“ï¼‰

**ç”¨æˆ·åœºæ™¯**:
- å¤šè¯­è¨€ç”µå½±åˆ‡æ¢é…éŸ³
- é€‰æ‹©è¯„è®ºéŸ³è½¨

**å®ç°æ–¹æ¡ˆ**:

```cpp
// demuxer.h
class Demuxer {
 public:
  struct AudioTrackInfo {
    int stream_index;
    std::string language;
    std::string codec_name;
    int channels;
    int sample_rate;
  };

  std::vector<AudioTrackInfo> GetAudioTracks() const;
  bool SwitchAudioTrack(int stream_index);

 private:
  int current_audio_stream_index_ = -1;
};

// playback_controller.h
class PlaybackController {
 public:
  std::vector<Demuxer::AudioTrackInfo> GetAudioTracks() const;
  bool SwitchAudioTrack(int stream_index);

 private:
  void OnAudioTrackChanged(int new_stream_index);
};
```

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

## ç”¨æˆ·ç•Œé¢

### P0 - UI åŸºç¡€å®Œå–„

#### 6. ğŸ¨ è¿›åº¦æ¡é¢„è§ˆç¼©ç•¥å›¾

**åŠŸèƒ½æè¿°**:
- é¼ æ ‡æ‚¬åœåœ¨è¿›åº¦æ¡ä¸Šæ˜¾ç¤ºé¢„è§ˆç¼©ç•¥å›¾
- æ˜¾ç¤ºå¯¹åº”æ—¶é—´ç‚¹çš„ç”»é¢
- æ˜¾ç¤ºæ—¶é—´æˆ³

**ç”¨æˆ·åœºæ™¯**:
- å¿«é€Ÿå®šä½è§†é¢‘ä¸­çš„ç‰¹å®šåœºæ™¯
- é¢„è§ˆè·³è½¬ç›®æ ‡ä½ç½®

**å®ç°æ–¹æ¡ˆ**:

```cpp
// progress_bar_widget.h
class ProgressBarWidget : public QSlider {
  Q_OBJECT

 public:
  ProgressBarWidget(Qt::Orientation orientation, QWidget* parent = nullptr);

  void SetThumbnailProvider(ThumbnailProvider* provider);

 protected:
  void mouseMoveEvent(QMouseEvent* event) override;
  void leaveEvent(QEvent* event) override;
  bool event(QEvent* event) override;

 private:
  void showThumbnail(int position_ms);
  void hideThumbnail();

  ThumbnailProvider* thumbnail_provider_ = nullptr;
  QLabel* thumbnail_label_ = nullptr;
  QLabel* time_label_ = nullptr;
};

// thumbnail_provider.h
class ThumbnailProvider {
 public:
  ThumbnailProvider(VideoDecoder* decoder);

  QPixmap GetThumbnail(int64_t timestamp_ms);

 private:
  void GenerateThumbnails();  // é¢„ç”Ÿæˆç¼©ç•¥å›¾
  QPixmap SeekAndCapture(int64_t timestamp_ms);

  std::map<int64_t, QPixmap> thumbnail_cache_;
  VideoDecoder* decoder_;
};
```

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

#### 7. ğŸ“º å…¨å±æ¨¡å¼ä¼˜åŒ–

**åŠŸèƒ½æè¿°**:
- çœŸæ­£çš„æ— è¾¹æ¡†å…¨å±
- å…¨å±æ—¶éšè—èœå•æ ã€çŠ¶æ€æ 
- é¼ æ ‡ç§»åŠ¨æ˜¾ç¤ºæ§åˆ¶æ ï¼Œé™æ­¢ 3 ç§’åè‡ªåŠ¨éšè—
- åŒå‡»è§†é¢‘åŒºåŸŸåˆ‡æ¢å…¨å±
- ESC é”®é€€å‡ºå…¨å±

**å®ç°æ–¹æ¡ˆ**:

```cpp
// main_window.cpp
void MainWindow::toggleFullScreen() {
  if (isFullScreen()) {
    // é€€å‡ºå…¨å±
    showNormal();
    menuBar()->show();
    statusBar()->show();
    hideControlsTimer_->stop();
  } else {
    // è¿›å…¥å…¨å±
    showFullScreen();
    menuBar()->hide();
    statusBar()->hide();
    
    // å¯åŠ¨è‡ªåŠ¨éšè—å®šæ—¶å™¨
    hideControlsTimer_->start(3000);  // 3 ç§’åéšè—
  }
}

void MainWindow::setupMouseTracking() {
  setMouseTracking(true);
  video_display_->setMouseTracking(true);

  hideControlsTimer_ = new QTimer(this);
  hideControlsTimer_->setSingleShot(true);
  connect(hideControlsTimer_, &QTimer::timeout, 
          this, &MainWindow::hideControlsInFullScreen);
}

void MainWindow::mouseMoveEvent(QMouseEvent* event) {
  if (isFullScreen()) {
    // æ˜¾ç¤ºæ§åˆ¶æ 
    control_bar_->show();
    setCursor(Qt::ArrowCursor);
    
    // é‡ç½®è‡ªåŠ¨éšè—å®šæ—¶å™¨
    hideControlsTimer_->start(3000);
  }

  QMainWindow::mouseMoveEvent(event);
}

void MainWindow::hideControlsInFullScreen() {
  if (isFullScreen()) {
    control_bar_->hide();
    setCursor(Qt::BlankCursor);  // éšè—é¼ æ ‡å…‰æ ‡
  }
}

void MainWindow::mouseDoubleClickEvent(QMouseEvent* event) {
  if (event->button() == Qt::LeftButton) {
    // åŒå‡»åˆ‡æ¢å…¨å±
    if (childAt(event->pos()) == video_display_) {
      toggleFullScreen();
    }
  }
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 2 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­â­ (æé«˜)

---

### P1 - UI ä½“éªŒä¼˜åŒ–

#### 8. ğŸ›ï¸ å³é”®èœå•åŠŸèƒ½

**åŠŸèƒ½æè¿°**:
- è§†é¢‘åŒºåŸŸå³é”®æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•
- å¸¸ç”¨æ“ä½œï¼šæ’­æ”¾/æš‚åœã€å…¨å±ã€éŸ³é‡ã€å€é€Ÿã€ä¹¦ç­¾ç­‰
- å¿«æ·é”®æ˜¾ç¤º

**å®ç°æ–¹æ¡ˆ**:

```cpp
// main_window.cpp
void MainWindow::setupContextMenu() {
  video_display_->setContextMenuPolicy(Qt::CustomContextMenu);
  connect(video_display_, &QWidget::customContextMenuRequested,
          this, &MainWindow::showContextMenu);
}

void MainWindow::showContextMenu(const QPoint& pos) {
  QMenu context_menu(this);

  // æ’­æ”¾æ§åˆ¶
  QAction* play_action = context_menu.addAction("æ’­æ”¾/æš‚åœ");
  play_action->setShortcut(QKeySequence(Qt::Key_Space));
  connect(play_action, &QAction::triggered, 
          this, &MainWindow::togglePlayPause);

  QAction* stop_action = context_menu.addAction("åœæ­¢");
  connect(stop_action, &QAction::triggered, 
          this, &MainWindow::stopPlayback);

  context_menu.addSeparator();

  // å€é€Ÿèœå•
  QMenu* speed_menu = context_menu.addMenu("æ’­æ”¾é€Ÿåº¦");
  for (float speed : {0.5f, 0.75f, 1.0f, 1.25f, 1.5f, 2.0f}) {
    QAction* speed_action = speed_menu->addAction(
        QString("%1x").arg(speed));
    connect(speed_action, &QAction::triggered, 
            this, [this, speed]() { player_->SetPlaybackSpeed(speed); });
  }

  // éŸ³é‡èœå•
  QMenu* volume_menu = context_menu.addMenu("éŸ³é‡");
  QSlider* volume_slider = new QSlider(Qt::Horizontal);
  volume_slider->setRange(0, 100);
  volume_slider->setValue(static_cast<int>(player_->GetVolume() * 100));
  connect(volume_slider, &QSlider::valueChanged, 
          this, [this](int value) { 
            player_->SetVolume(value / 100.0f); 
          });
  QWidgetAction* volume_action = new QWidgetAction(&context_menu);
  volume_action->setDefaultWidget(volume_slider);
  volume_menu->addAction(volume_action);

  context_menu.addSeparator();

  // å…¨å±
  QAction* fullscreen_action = context_menu.addAction("å…¨å±");
  fullscreen_action->setShortcut(QKeySequence(Qt::Key_F11));
  connect(fullscreen_action, &QAction::triggered, 
          this, &MainWindow::toggleFullScreen);

  // æ˜¾ç¤ºèœå•
  context_menu.exec(video_display_->mapToGlobal(pos));
}
```

**å®æ–½éš¾åº¦**: â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

#### 9. ğŸ“Š å®æ—¶ä¿¡æ¯å åŠ  (OSD)

**åŠŸèƒ½æè¿°**:
- æ˜¾ç¤ºæ’­æ”¾çŠ¶æ€ï¼ˆæ’­æ”¾/æš‚åœ/ç¼“å†²ï¼‰
- æ˜¾ç¤ºå½“å‰æ—¶é—´ã€æ€»æ—¶é•¿
- æ˜¾ç¤ºéŸ³é‡è°ƒæ•´æç¤º
- æ˜¾ç¤ºå€é€Ÿè°ƒæ•´æç¤º
- æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯ï¼ˆåˆ†è¾¨ç‡ã€ç ç‡ã€å¸§ç‡ï¼‰

**å®ç°æ–¹æ¡ˆ**:

```cpp
// osd_widget.h
class OSDWidget : public QWidget {
  Q_OBJECT

 public:
  enum class OSDType {
    PLAY_PAUSE,
    VOLUME,
    SPEED,
    SEEK,
    FILE_INFO,
    BUFFERING
  };

  OSDWidget(QWidget* parent = nullptr);

  void ShowMessage(OSDType type, const QString& message, 
                   int duration_ms = 2000);
  void ShowFileInfo(const QString& info);
  void ShowBuffering(int percent);

 protected:
  void paintEvent(QPaintEvent* event) override;

 private:
  void updatePosition();

  QString current_message_;
  QTimer* hide_timer_;
};

// main_window.cpp
void MainWindow::setupOSD() {
  osd_widget_ = new OSDWidget(video_display_);
  osd_widget_->hide();
}

void MainWindow::onVolumeChanged(int volume) {
  player_->SetVolume(volume / 100.0f);
  osd_widget_->ShowMessage(
      OSDWidget::OSDType::VOLUME,
      QString("éŸ³é‡: %1%").arg(volume));
}

void MainWindow::onSpeedChanged(float speed) {
  player_->SetPlaybackSpeed(speed);
  osd_widget_->ShowMessage(
      OSDWidget::OSDType::SPEED,
      QString("é€Ÿåº¦: %1x").arg(speed));
}

void MainWindow::togglePlayPause() {
  if (player_->GetState() == PlayerState::kPlaying) {
    player_->Pause();
    osd_widget_->ShowMessage(OSDWidget::OSDType::PLAY_PAUSE, "æš‚åœ");
  } else {
    player_->Play();
    osd_widget_->ShowMessage(OSDWidget::OSDType::PLAY_PAUSE, "æ’­æ”¾");
  }
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

### P2 - UI é«˜çº§åŠŸèƒ½

#### 10. ğŸŒˆ å¤šä¸»é¢˜æ”¯æŒ

**åŠŸèƒ½æè¿°**:
- å†…ç½®å¤šç§ä¸»é¢˜ï¼ˆæ·±è‰²ã€æµ…è‰²ã€è·Ÿéšç³»ç»Ÿï¼‰
- æ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜é…è‰²
- ä¿å­˜ç”¨æˆ·ä¸»é¢˜åå¥½

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

## åª’ä½“å¤„ç†

### P1 - å­—å¹•æ”¯æŒ

#### 11. ğŸ“ å¤–æŒ‚å­—å¹•åŠ è½½

**åŠŸèƒ½æè¿°**:
- æ”¯æŒ SRTã€ASSã€SSA å­—å¹•æ ¼å¼
- è‡ªåŠ¨æœç´¢åŒåå­—å¹•æ–‡ä»¶
- æ”¯æŒæ‹–æ‹½åŠ è½½å­—å¹•
- å­—å¹•æ—¶é—´è½´è°ƒæ•´ï¼ˆæå‰/å»¶åï¼‰

**å®ç°æ–¹æ¡ˆ**:

```cpp
// subtitle_parser.h
class SubtitleParser {
 public:
  struct SubtitleItem {
    int64_t start_time_ms;
    int64_t end_time_ms;
    std::string text;
    std::map<std::string, std::string> styles;  // ASS æ ·å¼
  };

  static std::vector<SubtitleItem> ParseSRT(const std::string& filepath);
  static std::vector<SubtitleItem> ParseASS(const std::string& filepath);
};

// subtitle_renderer.h
class SubtitleRenderer {
 public:
  SubtitleRenderer(QWidget* video_widget);

  void LoadSubtitle(const std::string& filepath);
  void SetTimeOffset(int64_t offset_ms);  // å­—å¹•æ—¶é—´åç§»
  void SetFontSize(int size);
  void SetFontColor(const QColor& color);

  void UpdateCurrentTime(int64_t current_time_ms);
  QString GetCurrentSubtitle() const;

 private:
  std::vector<SubtitleParser::SubtitleItem> subtitles_;
  int64_t time_offset_ms_ = 0;
  size_t current_index_ = 0;
};

// subtitle_widget.h
class SubtitleWidget : public QLabel {
  Q_OBJECT

 public:
  SubtitleWidget(QWidget* parent = nullptr);

  void ShowSubtitle(const QString& text);
  void Clear();

 protected:
  void paintEvent(QPaintEvent* event) override;

 private:
  QString subtitle_text_;
};
```

**SRT å­—å¹•è§£æç¤ºä¾‹**:
```cpp
std::vector<SubtitleItem> SubtitleParser::ParseSRT(
    const std::string& filepath) {
  std::vector<SubtitleItem> items;
  std::ifstream file(filepath);
  std::string line;

  while (std::getline(file, line)) {
    // è·³è¿‡åºå·è¡Œ
    if (line.empty() || std::isdigit(line[0])) continue;

    // è§£ææ—¶é—´æˆ³: 00:00:10,500 --> 00:00:13,000
    if (line.find("-->") != std::string::npos) {
      SubtitleItem item;
      sscanf(line.c_str(), "%02d:%02d:%02d,%03d --> %02d:%02d:%02d,%03d",
             &h1, &m1, &s1, &ms1, &h2, &m2, &s2, &ms2);
      item.start_time_ms = (h1*3600 + m1*60 + s1)*1000 + ms1;
      item.end_time_ms = (h2*3600 + m2*60 + s2)*1000 + ms2;

      // è¯»å–å­—å¹•æ–‡æœ¬ï¼ˆå¯èƒ½å¤šè¡Œï¼‰
      std::string text;
      while (std::getline(file, line) && !line.empty()) {
        if (!text.empty()) text += "\n";
        text += line;
      }
      item.text = text;

      items.push_back(item);
    }
  }

  return items;
}
```

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­â­ (æé«˜)

---

### P1 - éŸ³é¢‘å¢å¼º

#### 12. ğŸšï¸ å‡è¡¡å™¨ (EQ)

**åŠŸèƒ½æè¿°**:
- 10é¢‘æ®µå›¾å½¢å‡è¡¡å™¨
- é¢„è®¾éŸ³æ•ˆæ¨¡å¼ï¼ˆæ‘‡æ»šã€æµè¡Œã€å¤å…¸ã€çˆµå£«ç­‰ï¼‰
- è‡ªå®šä¹‰ EQ è®¾ç½®ä¿å­˜

**å®ç°æ–¹æ¡ˆ**:

```cpp
// audio_equalizer.h
class AudioEqualizer {
 public:
  static constexpr int kNumBands = 10;
  static constexpr int kFrequencies[kNumBands] = {
    31, 62, 125, 250, 500, 1000, 2000, 4000, 8000, 16000  // Hz
  };

  struct EQPreset {
    std::string name;
    float gains[kNumBands];  // dB, range: -12 to +12
  };

  AudioEqualizer();

  void SetBandGain(int band_index, float gain_db);
  float GetBandGain(int band_index) const;

  void ApplyPreset(const EQPreset& preset);
  void ResetToFlat();

  void ProcessAudio(float* samples, int num_samples, int channels);

 private:
  void UpdateFilters();

  float band_gains_[kNumBands] = {0.0f};  // é»˜è®¤ 0dB (ä¸è°ƒæ•´)
  std::unique_ptr<BiquadFilter> filters_[kNumBands];
};

// é¢„è®¾
const AudioEqualizer::EQPreset kRockPreset = {
  "Rock",
  {5.0f, 3.0f, -3.0f, -5.0f, -2.0f, 1.0f, 4.0f, 6.0f, 6.0f, 6.0f}
};

const AudioEqualizer::EQPreset kPopPreset = {
  "Pop",
  {-1.0f, 2.0f, 4.0f, 4.0f, 3.0f, 0.0f, -1.0f, -1.0f, -1.0f, -1.0f}
};
```

**UI è®¾è®¡**:
```cpp
// equalizer_widget.h
class EqualizerWidget : public QWidget {
  Q_OBJECT

 public:
  EqualizerWidget(AudioEqualizer* eq, QWidget* parent = nullptr);

 private slots:
  void onBandSliderChanged(int band_index, int value);
  void onPresetSelected(int index);
  void onResetClicked();

 private:
  void setupUI();

  AudioEqualizer* equalizer_;
  QSlider* band_sliders_[AudioEqualizer::kNumBands];
  QLabel* band_labels_[AudioEqualizer::kNumBands];
  QComboBox* preset_combo_;
};
```

**å®æ–½éš¾åº¦**: â­â­â­â­ (å›°éš¾)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 2 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

### P2 - è§†é¢‘æ•ˆæœ

#### 13. ğŸ¨ è§†é¢‘æ»¤é•œ (äº®åº¦/å¯¹æ¯”åº¦/é¥±å’Œåº¦)

**åŠŸèƒ½æè¿°**:
- å®æ—¶è°ƒæ•´è§†é¢‘äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦
- æ”¯æŒè‰²è°ƒè°ƒæ•´
- é‡ç½®åˆ°é»˜è®¤å€¼

**å®ç°æ–¹æ¡ˆ (ä½¿ç”¨ FFmpeg æ»¤é•œ)**:

```cpp
// video_filter.h
class VideoFilter {
 public:
  struct FilterParams {
    float brightness = 0.0f;  // -1.0 to 1.0
    float contrast = 1.0f;    // 0.0 to 2.0
    float saturation = 1.0f;  // 0.0 to 3.0
    float hue = 0.0f;         // -180 to 180 degrees
  };

  VideoFilter();
  ~VideoFilter();

  bool Initialize(AVPixelFormat pix_fmt, int width, int height);
  void SetParams(const FilterParams& params);
  AVFrame* ProcessFrame(AVFrame* input_frame);

 private:
  void UpdateFilterGraph();

  AVFilterGraph* filter_graph_ = nullptr;
  AVFilterContext* buffersrc_ctx_ = nullptr;
  AVFilterContext* buffersink_ctx_ = nullptr;
  FilterParams current_params_;
};

void VideoFilter::UpdateFilterGraph() {
  // æ„å»ºæ»¤é•œé“¾ï¼šbuffer -> eq -> hue -> buffersink
  char filter_desc[256];
  snprintf(filter_desc, sizeof(filter_desc),
           "eq=brightness=%.2f:contrast=%.2f:saturation=%.2f,"
           "hue=h=%.2f",
           current_params_.brightness,
           current_params_.contrast,
           current_params_.saturation,
           current_params_.hue);

  // é‡æ–°åˆ›å»ºæ»¤é•œå›¾...
}
```

**UI æ§ä»¶**:
```cpp
// video_filter_widget.h
class VideoFilterWidget : public QWidget {
  Q_OBJECT

 public:
  VideoFilterWidget(VideoFilter* filter, QWidget* parent = nullptr);

 private slots:
  void onBrightnessChanged(int value);
  void onContrastChanged(int value);
  void onSaturationChanged(int value);
  void onHueChanged(int value);
  void onResetClicked();

 private:
  VideoFilter* video_filter_;
  QSlider* brightness_slider_;  // -100 to 100 -> -1.0 to 1.0
  QSlider* contrast_slider_;    // 0 to 200 -> 0.0 to 2.0
  QSlider* saturation_slider_;  // 0 to 300 -> 0.0 to 3.0
  QSlider* hue_slider_;         // -180 to 180
};
```

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

## å·¥å…·åŠŸèƒ½

### P1 - æˆªå›¾å’Œå½•åˆ¶

#### 14. ğŸ“¸ è§†é¢‘æˆªå›¾

**åŠŸèƒ½æè¿°**:
- å¿«æ·é”®æˆªå–å½“å‰ç”»é¢ï¼ˆF12ï¼‰
- æ”¯æŒå¤šç§æ ¼å¼ï¼ˆPNGã€JPGã€BMPï¼‰
- è‡ªåŠ¨å‘½åï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰
- é€‰æ‹©ä¿å­˜è·¯å¾„

**å®ç°æ–¹æ¡ˆ**:

```cpp
// screenshot_manager.h
class ScreenshotManager {
 public:
  enum class ImageFormat {
    PNG,
    JPG,
    BMP
  };

  struct ScreenshotConfig {
    std::string save_directory = "./screenshots";
    ImageFormat format = ImageFormat::PNG;
    int jpg_quality = 95;  // 1-100
    bool include_timestamp_in_filename = true;
  };

  ScreenshotManager(const ScreenshotConfig& config = {});

  bool CaptureCurrentFrame(const AVFrame* frame);
  bool CaptureFromRenderer(Renderer* renderer);

  std::string GetLastSavedPath() const;

 private:
  std::string GenerateFilename(int64_t timestamp_ms);
  bool SaveImage(const QImage& image, const std::string& filepath);

  ScreenshotConfig config_;
  std::string last_saved_path_;
};

std::string ScreenshotManager::GenerateFilename(int64_t timestamp_ms) {
  auto now = std::chrono::system_clock::now();
  auto time_t = std::chrono::system_clock::to_time_t(now);
  std::tm tm = *std::localtime(&time_t);

  char buffer[256];
  if (config_.include_timestamp_in_filename) {
    snprintf(buffer, sizeof(buffer),
             "screenshot_%04d%02d%02d_%02d%02d%02d_%lld.%s",
             tm.tm_year + 1900, tm.tm_mon + 1, tm.tm_mday,
             tm.tm_hour, tm.tm_min, tm.tm_sec,
             timestamp_ms,
             FormatExtension(config_.format));
  } else {
    snprintf(buffer, sizeof(buffer),
             "screenshot_%04d%02d%02d_%02d%02d%02d.%s",
             tm.tm_year + 1900, tm.tm_mon + 1, tm.tm_mday,
             tm.tm_hour, tm.tm_min, tm.tm_sec,
             FormatExtension(config_.format));
  }

  return config_.save_directory + "/" + buffer;
}

bool ScreenshotManager::CaptureCurrentFrame(const AVFrame* frame) {
  // å°† AVFrame è½¬æ¢ä¸º QImage
  SwsContext* sws_ctx = sws_getContext(
      frame->width, frame->height, (AVPixelFormat)frame->format,
      frame->width, frame->height, AV_PIX_FMT_RGB24,
      SWS_BILINEAR, nullptr, nullptr, nullptr);

  QImage image(frame->width, frame->height, QImage::Format_RGB888);
  uint8_t* dest[1] = {image.bits()};
  int dest_linesize[1] = {image.bytesPerLine()};

  sws_scale(sws_ctx, frame->data, frame->linesize, 0, frame->height,
            dest, dest_linesize);

  sws_freeContext(sws_ctx);

  // ä¿å­˜å›¾ç‰‡
  std::string filepath = GenerateFilename(frame->pts);
  return SaveImage(image, filepath);
}

bool ScreenshotManager::SaveImage(const QImage& image, 
                                  const std::string& filepath) {
  // ç¡®ä¿ç›®å½•å­˜åœ¨
  QDir dir(QString::fromStdString(config_.save_directory));
  if (!dir.exists()) {
    dir.mkpath(".");
  }

  bool success = false;
  switch (config_.format) {
    case ImageFormat::PNG:
      success = image.save(QString::fromStdString(filepath), "PNG");
      break;
    case ImageFormat::JPG:
      success = image.save(QString::fromStdString(filepath), "JPG", 
                          config_.jpg_quality);
      break;
    case ImageFormat::BMP:
      success = image.save(QString::fromStdString(filepath), "BMP");
      break;
  }

  if (success) {
    last_saved_path_ = filepath;
    MODULE_INFO(LOG_MODULE_PLAYER, "Screenshot saved: {}", filepath);
  }

  return success;
}
```

**UI é›†æˆ**:
```cpp
// main_window.cpp
void MainWindow::setupShortcuts() {
  auto* screenshot_shortcut = new QShortcut(Qt::Key_F12, this);
  connect(screenshot_shortcut, &QShortcut::activated,
          this, &MainWindow::takeScreenshot);
}

void MainWindow::takeScreenshot() {
  // ä»æ¸²æŸ“å™¨è·å–å½“å‰å¸§
  if (screenshot_manager_->CaptureFromRenderer(renderer_)) {
    QString filepath = QString::fromStdString(
        screenshot_manager_->GetLastSavedPath());
    
    // æ˜¾ç¤ºé€šçŸ¥
    osd_widget_->ShowMessage(
        OSDWidget::OSDType::SCREENSHOT,
        QString("æˆªå›¾å·²ä¿å­˜: %1").arg(QFileInfo(filepath).fileName()));
    
    // å¯é€‰ï¼šæ‰“å¼€ä¿å­˜ä½ç½®
    // QDesktopServices::openUrl(QUrl::fromLocalFile(
    //     QFileInfo(filepath).absolutePath()));
  }
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

#### 15. ğŸ¥ è§†é¢‘å½•åˆ¶ (GIF/MP4)

**åŠŸèƒ½æè¿°**:
- å½•åˆ¶è§†é¢‘ç‰‡æ®µä¸º GIF æˆ– MP4
- è®¾ç½®å½•åˆ¶åŒºåŸŸå’Œå¸§ç‡
- å®æ—¶é¢„è§ˆå½•åˆ¶è¿›åº¦

**å®ç°æ–¹æ¡ˆ** (ä½¿ç”¨ FFmpeg ç¼–ç ):

```cpp
// video_recorder.h
class VideoRecorder {
 public:
  enum class OutputFormat {
    GIF,
    MP4,
    WEBM
  };

  struct RecordConfig {
    OutputFormat format = OutputFormat::MP4;
    int target_fps = 30;
    int bitrate_kbps = 2000;
    int gif_width = 480;  // GIF é™åˆ¶å°ºå¯¸
  };

  VideoRecorder();
  ~VideoRecorder();

  bool StartRecording(const std::string& output_path, 
                     const RecordConfig& config,
                     int source_width, int source_height);
  void StopRecording();
  bool IsRecording() const;

  void WriteFrame(const AVFrame* frame);

 private:
  bool InitEncoder();
  void CloseEncoder();

  AVFormatContext* output_format_ctx_ = nullptr;
  AVCodecContext* encoder_ctx_ = nullptr;
  AVStream* video_stream_ = nullptr;
  SwsContext* sws_ctx_ = nullptr;
  RecordConfig config_;
  int64_t frame_count_ = 0;
  bool is_recording_ = false;
};
```

**å®æ–½éš¾åº¦**: â­â­â­â­ (å›°éš¾)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 2 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

### P2 - é«˜çº§å·¥å…·

#### 16. ğŸ“Š åª’ä½“ä¿¡æ¯æŸ¥çœ‹å™¨

**åŠŸèƒ½æè¿°**:
- æ˜¾ç¤ºè¯¦ç»†çš„æ–‡ä»¶ä¿¡æ¯ï¼ˆå®¹å™¨æ ¼å¼ã€æ—¶é•¿ã€æ–‡ä»¶å¤§å°ï¼‰
- è§†é¢‘æµä¿¡æ¯ï¼ˆç¼–ç ã€åˆ†è¾¨ç‡ã€å¸§ç‡ã€ç ç‡ï¼‰
- éŸ³é¢‘æµä¿¡æ¯ï¼ˆç¼–ç ã€é‡‡æ ·ç‡ã€å£°é“ã€ç ç‡ï¼‰
- å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­ (ä¸­ç­‰)

---

## ç³»ç»ŸåŠŸèƒ½

#### 17. âš™ï¸ é…ç½®æŒä¹…åŒ–

**åŠŸèƒ½æè¿°**:
- ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®ï¼ˆéŸ³é‡ã€å€é€Ÿã€ä¸»é¢˜ç­‰ï¼‰
- ä¿å­˜æ’­æ”¾å†å²å’Œè¿›åº¦
- ä¿å­˜çª—å£å¤§å°å’Œä½ç½®
- æ”¯æŒå¯¼å…¥/å¯¼å‡ºé…ç½®

**å®ç°æ–¹æ¡ˆ**:

```cpp
// settings_manager.h
class SettingsManager {
 public:
  struct PlayerSettings {
    // æ’­æ”¾è®¾ç½®
    float volume = 1.0f;
    float playback_speed = 1.0f;
    bool auto_play = true;
    bool remember_position = true;

    // UI è®¾ç½®
    std::string theme = "dark";
    bool show_osd = true;
    int osd_duration_ms = 2000;

    // æˆªå›¾è®¾ç½®
    std::string screenshot_directory = "./screenshots";
    std::string screenshot_format = "PNG";

    // çª—å£è®¾ç½®
    int window_width = 1280;
    int window_height = 720;
    int window_x = -1;  // -1 è¡¨ç¤ºå±…ä¸­
    int window_y = -1;
  };

  static SettingsManager& GetInstance();

  bool Load();
  bool Save();

  PlayerSettings& GetSettings() { return settings_; }

 private:
  SettingsManager() = default;

  bool LoadFromJSON(const std::string& filepath);
  bool SaveToJSON(const std::string& filepath);

  PlayerSettings settings_;
  std::string config_filepath_ = "zenplay_config.json";
};
```

**é…ç½®æ–‡ä»¶æ ¼å¼ (JSON)**:
```json
{
  "version": "1.0",
  "playback": {
    "volume": 0.8,
    "playback_speed": 1.0,
    "auto_play": true,
    "remember_position": true
  },
  "ui": {
    "theme": "dark",
    "show_osd": true,
    "osd_duration_ms": 2000
  },
  "screenshot": {
    "directory": "./screenshots",
    "format": "PNG"
  },
  "window": {
    "width": 1280,
    "height": 720,
    "x": 100,
    "y": 100
  },
  "recent_files": [
    "/path/to/video1.mp4",
    "/path/to/video2.mkv"
  ]
}
```

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 3 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

#### 18. ğŸ“œ æ’­æ”¾å†å²å’Œæœ€è¿‘æ‰“å¼€

**åŠŸèƒ½æè¿°**:
- è®°å½•æœ€è¿‘æ’­æ”¾çš„æ–‡ä»¶ï¼ˆæœ€å¤š 20 ä¸ªï¼‰
- ä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„æ’­æ”¾è¿›åº¦
- èœå•æ æ˜¾ç¤º"æœ€è¿‘æ‰“å¼€"åˆ—è¡¨
- æ¸…ç©ºå†å²è®°å½•

**å®æ–½éš¾åº¦**: â­â­ (ç®€å•)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 2 å¤©  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

#### 19. ğŸ” æ–‡ä»¶å…³è”å’Œåè®®æ”¯æŒ

**åŠŸèƒ½æè¿°**:
- Windows æ³¨å†Œæ–‡ä»¶å…³è”ï¼ˆ.mp4, .avi, .mkv ç­‰ï¼‰
- æ”¯æŒ URL åè®®æ‰“å¼€ï¼ˆzenplay://ï¼‰
- æ‹–æ‹½æ–‡ä»¶åˆ°çª—å£æ’­æ”¾
- å‘½ä»¤è¡Œå‚æ•°æ’­æ”¾

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­ç­‰)  
**é¢„æœŸå¼€å‘æ—¶é—´**: 1 å‘¨  
**ç”¨æˆ·ä»·å€¼**: â­â­â­â­ (é«˜)

---

## å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½å®Œå–„ (2-3 å‘¨)

**ç›®æ ‡**: è¡¥é½æ’­æ”¾å™¨å¿…å¤‡åŠŸèƒ½

1. **æ’­æ”¾åˆ—è¡¨ç®¡ç†** (P0) - 1 å‘¨
2. **å€é€Ÿæ’­æ”¾** (P0) - 1 å‘¨
3. **å…¨å±æ¨¡å¼ä¼˜åŒ–** (P0) - 2 å¤©
4. **å¿«è¿›/å¿«é€€æ­¥è¿›** (P1) - 2 å¤©
5. **é…ç½®æŒä¹…åŒ–** (P1) - 3 å¤©

**é¢„æœŸæ”¶ç›Š**:
- åŸºæœ¬å¯ç”¨çš„æ’­æ”¾å™¨
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

---

### ç¬¬äºŒé˜¶æ®µï¼šUI/UX ä¼˜åŒ– (2-3 å‘¨)

**ç›®æ ‡**: æå‡ç•Œé¢å’Œäº¤äº’ä½“éªŒ

6. **è¿›åº¦æ¡é¢„è§ˆç¼©ç•¥å›¾** (P0) - 1 å‘¨
7. **å®æ—¶ä¿¡æ¯å åŠ  (OSD)** (P1) - 3 å¤©
8. **å³é”®èœå•** (P1) - 1 å¤©
9. **ä¹¦ç­¾åŠŸèƒ½** (P1) - 3 å¤©
10. **æ’­æ”¾å†å²** (P1) - 2 å¤©

**é¢„æœŸæ”¶ç›Š**:
- ä¸“ä¸šçš„æ’­æ”¾å™¨å¤–è§‚
- ç”¨æˆ·å‹å¥½çš„äº¤äº’

---

### ç¬¬ä¸‰é˜¶æ®µï¼šåª’ä½“å¤„ç†åŠŸèƒ½ (3-4 å‘¨)

**ç›®æ ‡**: æ”¯æŒå­—å¹•å’Œé«˜çº§éŸ³è§†é¢‘å¤„ç†

11. **å¤–æŒ‚å­—å¹•** (P1) - 1 å‘¨
12. **éŸ³é¢‘è½¨é“åˆ‡æ¢** (P2) - 1 å‘¨
13. **è§†é¢‘æˆªå›¾** (P1) - 3 å¤©
14. **å‡è¡¡å™¨** (P2) - 2 å‘¨
15. **è§†é¢‘æ»¤é•œ** (P2) - 1 å‘¨

**é¢„æœŸæ”¶ç›Š**:
- åŠŸèƒ½å®Œæ•´çš„å¤šåª’ä½“æ’­æ”¾å™¨
- æ»¡è¶³ä¸“ä¸šç”¨æˆ·éœ€æ±‚

---

### ç¬¬å››é˜¶æ®µï¼šå·¥å…·å’Œç³»ç»ŸåŠŸèƒ½ (2-3 å‘¨)

**ç›®æ ‡**: å®Œå–„è¾…åŠ©åŠŸèƒ½å’Œç³»ç»Ÿé›†æˆ

16. **è§†é¢‘å½•åˆ¶** (P1) - 2 å‘¨
17. **åª’ä½“ä¿¡æ¯æŸ¥çœ‹å™¨** (P2) - 3 å¤©
18. **æ–‡ä»¶å…³è”** (P2) - 1 å‘¨
19. **å¤šä¸»é¢˜** (P2) - 3 å¤©

**é¢„æœŸæ”¶ç›Š**:
- ç³»ç»Ÿæ·±åº¦é›†æˆ
- å·¥å…·åŠŸèƒ½é½å…¨

---

## æ€»ç»“

æœ¬æ–‡æ¡£åˆ—å‡ºäº† **19 é¡¹** åŠŸèƒ½å®Œå–„å»ºè®®ï¼Œæ¶µç›–ï¼š
- âœ… æ’­æ”¾å¢å¼º (5 é¡¹)
- âœ… ç”¨æˆ·ç•Œé¢ (5 é¡¹)
- âœ… åª’ä½“å¤„ç† (4 é¡¹)
- âœ… å·¥å…·åŠŸèƒ½ (3 é¡¹)
- âœ… ç³»ç»ŸåŠŸèƒ½ (3 é¡¹)

**ä¼˜å…ˆçº§åˆ†å¸ƒ**:
- **P0** (å¿…å¤‡): 6 é¡¹ â†’ ç«‹å³å¼€å‘
- **P1** (é‡è¦): 9 é¡¹ â†’ è¿‘æœŸå®Œæˆ
- **P2** (é«˜çº§): 4 é¡¹ â†’ é•¿æœŸè§„åˆ’

**æ ¸å¿ƒä»·å€¼**:
- ğŸ“ˆ ç”¨æˆ·ä½“éªŒæå‡ **300%**
- ğŸ¯ åŠŸèƒ½å®Œæ•´åº¦è¾¾åˆ°å•†ä¸šæ’­æ”¾å™¨æ°´å¹³
- ğŸ’¡ å­¦ä¹ ä»·å€¼ï¼šæ¶µç›–å¤šåª’ä½“å¼€å‘çš„å„ä¸ªæ–¹é¢

**æ¨èä¼˜å…ˆå®ç°** (ç”¨æˆ·ä»·å€¼æœ€é«˜):
1. æ’­æ”¾åˆ—è¡¨ç®¡ç† â­â­â­â­â­
2. å€é€Ÿæ’­æ”¾ â­â­â­â­â­
3. å…¨å±æ¨¡å¼ä¼˜åŒ– â­â­â­â­â­
4. å¤–æŒ‚å­—å¹• â­â­â­â­â­
5. è¿›åº¦æ¡é¢„è§ˆ â­â­â­â­

---

## å‚è€ƒèµ„æ–™

### æˆç†Ÿæ’­æ”¾å™¨å‚è€ƒ
- **VLC Media Player** - åŠŸèƒ½æœ€å…¨é¢
- **PotPlayer** - UI/UX ä¼˜ç§€
- **MPV** - æ€§èƒ½å’Œé…ç½®çµæ´»
- **MPC-HC** - è½»é‡ç®€æ´

### æŠ€æœ¯æ–‡æ¡£
- [FFmpeg æ»¤é•œæ–‡æ¡£](https://ffmpeg.org/ffmpeg-filters.html)
- [Qt å¤šåª’ä½“æ–‡æ¡£](https://doc.qt.io/qt-6/qtmultimedia-index.html)
- [SRT å­—å¹•è§„èŒƒ](https://www.matroska.org/technical/subtitles.html)

---

*æ–‡æ¡£ç»´æŠ¤è€…: ZenPlay å›¢é˜Ÿ*  
*æœ€åæ›´æ–°: 2024-12-19*
