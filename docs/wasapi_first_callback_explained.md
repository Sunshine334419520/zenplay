# WASAPI ç¬¬ä¸€æ¬¡å›è°ƒæœºåˆ¶è¯¦è§£

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

**"ç¬¬ä¸€æ¬¡å›è°ƒ"ä¸æ˜¯æŒ‡ 1 ç§’åå›è°ƒï¼Œè€Œæ˜¯æŒ‡å¯åŠ¨åçš„ç¬¬ä¸€æ¬¡ GetBuffer è°ƒç”¨ï¼**

---

## ğŸ“Š WASAPI å·¥ä½œæµç¨‹

### å®Œæ•´æ—¶é—´çº¿

```
T0: è°ƒç”¨ audio_client_->Start()
    â”œâ”€ åˆå§‹åŒ–ç¡¬ä»¶ç¼“å†²åŒºï¼ˆ1 ç§’ = 44100 å¸§ï¼‰
    â””â”€ ç¼“å†²åŒºçŠ¶æ€ï¼šç©º
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
        â”‚                   0 / 44100 å¸§                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T0 + å‡ æ¯«ç§’: éŸ³é¢‘çº¿ç¨‹ç¬¬ä¸€æ¬¡æ‰§è¡Œ
    â”‚
    â”œâ”€ GetCurrentPadding() è¿”å›ï¼š0 å¸§ï¼ˆç¼“å†²åŒºæ˜¯ç©ºçš„ï¼‰
    â”œâ”€ available_frames = 44100 - 0 = 44100 å¸§
    â”œâ”€ GetBuffer(44100) â† ğŸ”¥ ç¬¬ä¸€æ¬¡å›è°ƒï¼
    â”‚  â””â”€ è¯·æ±‚å¡«å……æ•´ä¸ªç¼“å†²åŒºï¼ˆ1 ç§’éŸ³é¢‘ï¼‰
    â”‚
    â””â”€ AudioOutputCallback() è¢«è°ƒç”¨
       â”œâ”€ å‚æ•°ï¼šbuffer_size = 44100 Ã— 4 = 176400 å­—èŠ‚
       â””â”€ éœ€è¦å¡«å…… 1 ç§’çš„éŸ³é¢‘æ•°æ®

T0 + ~10ms: ç¬¬ä¸€æ¬¡å›è°ƒå®Œæˆ
    â””â”€ ç¼“å†²åŒºçŠ¶æ€ï¼šæ»¡
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
        â”‚              44100 / 44100 å¸§                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T0 + ~10ms: éŸ³é¢‘å¼€å§‹æ’­æ”¾
    â””â”€ ç¡¬ä»¶å¼€å§‹æ¶ˆè´¹ç¼“å†²åŒºæ•°æ®

T0 + 20ms: ç¬¬äºŒæ¬¡å›è°ƒ
    â”œâ”€ GetCurrentPadding() è¿”å›ï¼š43659 å¸§ï¼ˆç¡¬ä»¶æ’­æ”¾äº† 10msï¼‰
    â”œâ”€ available_frames = 44100 - 43659 = 441 å¸§ï¼ˆ10msï¼‰
    â””â”€ GetBuffer(441) â† åªéœ€è¦å¡«å…… 10ms æ•°æ®

T0 + 30ms: ç¬¬ä¸‰æ¬¡å›è°ƒ
    â”œâ”€ GetCurrentPadding() è¿”å›ï¼š43218 å¸§
    â”œâ”€ available_frames = 44100 - 43218 = 882 å¸§ï¼ˆ20msï¼‰
    â””â”€ GetBuffer(882)

... æŒç»­æ¯ 10ms å›è°ƒä¸€æ¬¡
```

---

## ğŸ” è¯¦ç»†è§£æ

### 1. ç¬¬ä¸€æ¬¡å›è°ƒçš„æ—¶æœº

**ä¸æ˜¯ 1 ç§’åï¼Œè€Œæ˜¯å¯åŠ¨åç«‹å³ï¼ˆå‡ æ¯«ç§’å†…ï¼‰ï¼**

```cpp
// wasapi_audio_output.cpp - AudioThreadMain()

while (!should_stop_.load()) {
    // è·å–å½“å‰å·²å¡«å……çš„å¸§æ•°
    UINT32 padding_frames;
    audio_client_->GetCurrentPadding(&padding_frames);
    
    // ğŸ”¥ å¯åŠ¨æ—¶ padding_frames = 0ï¼ˆç¼“å†²åŒºæ˜¯ç©ºçš„ï¼‰
    
    // è®¡ç®—å¯ç”¨ç©ºé—´
    UINT32 available_frames = buffer_frame_count_ - padding_frames;
    // ğŸ”¥ ç¬¬ä¸€æ¬¡ï¼šavailable_frames = 44100 - 0 = 44100
    
    if (available_frames == 0) {
        Sleep(1);
        continue;
    }
    
    // è·å–ç¼“å†²åŒºæŒ‡é’ˆ
    BYTE* render_buffer;
    render_client_->GetBuffer(available_frames, &render_buffer);
    // ğŸ”¥ ç¬¬ä¸€æ¬¡è¯·æ±‚æ•´ä¸ªç¼“å†²åŒºï¼ˆ44100 å¸§ï¼‰
    
    // è°ƒç”¨å›è°ƒå‡½æ•°
    UINT32 bytes_to_fill = available_frames * frame_size;
    audio_callback_(user_data_, render_buffer, bytes_to_fill);
    // ğŸ”¥ ç¬¬ä¸€æ¬¡ï¼šbytes_to_fill = 44100 Ã— 4 = 176400 å­—èŠ‚
    
    // é‡Šæ”¾ç¼“å†²åŒº
    render_client_->ReleaseBuffer(available_frames, 0);
    
    // çŸ­æš‚ä¼‘çœ 
    Sleep(10);  // ğŸ”¥ æ¯ 10ms å¾ªç¯ä¸€æ¬¡
}
```

---

### 2. ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡è¯·æ±‚æ•´ä¸ªç¼“å†²åŒºï¼Ÿ

**WASAPI çš„è®¾è®¡ç†å¿µï¼š**

```
ç¼“å†²åŒºç®¡ç†ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WASAPI ç¼“å†²åŒºï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  [å†™å…¥ä½ç½®] â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ [æ’­æ”¾ä½ç½®]      â”‚
â”‚                                                  â”‚
â”‚  padding_frames = æ’­æ”¾ä½ç½®åˆ°å†™å…¥ä½ç½®ä¹‹é—´çš„å¸§æ•°   â”‚
â”‚  available_frames = ç¼“å†²åŒºå¤§å° - padding_frames  â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯åŠ¨æ—¶ï¼š
- æ’­æ”¾ä½ç½® = å†™å…¥ä½ç½® = 0
- padding_frames = 0
- available_frames = æ•´ä¸ªç¼“å†²åŒº

ç¬¬ä¸€æ¬¡å¡«å……åï¼š
- å†™å…¥ä½ç½® = 44100ï¼ˆå†™æ»¡äº†ï¼‰
- æ’­æ”¾ä½ç½® = 0ï¼ˆåˆšå¼€å§‹æ’­æ”¾ï¼‰
- padding_frames = 44100
- available_frames = 0ï¼ˆæš‚æ—¶ä¸éœ€è¦æ›´å¤šæ•°æ®ï¼‰

10ms åï¼ˆç¡¬ä»¶æ’­æ”¾äº† 10ms = 441 å¸§ï¼‰ï¼š
- å†™å…¥ä½ç½® = 44100
- æ’­æ”¾ä½ç½® = 441
- padding_frames = 44100 - 441 = 43659
- available_frames = 44100 - 43659 = 441
```

---

### 3. ç¼“å†²åŒºå¤§å°çš„å½±å“

#### ç¼“å†²åŒº = 1000ms (44100 å¸§)

```
å¯åŠ¨æµç¨‹ï¼š

T0: Start()
T0+5ms: ç¬¬ä¸€æ¬¡å›è°ƒ
  â”œâ”€ è¯·æ±‚ï¼š44100 å¸§ï¼ˆ1 ç§’éŸ³é¢‘ï¼‰
  â”œâ”€ AudioPlayer éœ€è¦ä»é˜Ÿåˆ—å–ï¼š~43 ä¸ªéŸ³é¢‘å¸§
  â””â”€ å¦‚æœé˜Ÿåˆ—åªæœ‰ 10 å¸§ â†’ å¡«å…… 0.23 ç§’éŸ³é¢‘ + 0.77 ç§’é™éŸ³

T0+15ms: ç¬¬äºŒæ¬¡å›è°ƒ
  â”œâ”€ è¯·æ±‚ï¼š441 å¸§ï¼ˆ10ms éŸ³é¢‘ï¼‰
  â”œâ”€ AudioPlayer éœ€è¦ä»é˜Ÿåˆ—å–ï¼š~1 ä¸ªéŸ³é¢‘å¸§
  â””â”€ å¦‚æœé˜Ÿåˆ—æœ‰å¸§ â†’ æ­£å¸¸å¡«å……

ä¼˜ç‚¹ï¼š
âœ… ç¬¬ä¸€æ¬¡å¡«å……åæœ‰ 1 ç§’ç¼“å†²
âœ… å³ä½¿ç¬¬ä¸€æ¬¡åªå¡«å……äº†éƒ¨åˆ†çœŸå®éŸ³é¢‘ï¼Œåç»­æœ‰å……è¶³æ—¶é—´è¡¥å……
âœ… å¯¹è§£ç é€Ÿåº¦å®¹å¿åº¦é«˜

ç¼ºç‚¹ï¼š
âŒ ç¬¬ä¸€æ¬¡éœ€è¦æä¾›å¤§é‡æ•°æ®ï¼ˆ43 å¸§ï¼‰
âŒ å¦‚æœé˜Ÿåˆ—å‡†å¤‡ä¸è¶³ï¼Œä¼šæœ‰è¾ƒå¤šé™éŸ³
```

#### ç¼“å†²åŒº = 100ms (4410 å¸§)

```
å¯åŠ¨æµç¨‹ï¼š

T0: Start()
T0+5ms: ç¬¬ä¸€æ¬¡å›è°ƒ
  â”œâ”€ è¯·æ±‚ï¼š4410 å¸§ï¼ˆ100ms éŸ³é¢‘ï¼‰
  â”œâ”€ AudioPlayer éœ€è¦ä»é˜Ÿåˆ—å–ï¼š~4 ä¸ªéŸ³é¢‘å¸§
  â””â”€ å¦‚æœé˜Ÿåˆ—åªæœ‰ 2 å¸§ â†’ å¡«å…… 46ms éŸ³é¢‘ + 54ms é™éŸ³

T0+15ms: ç¬¬äºŒæ¬¡å›è°ƒ
  â”œâ”€ è¯·æ±‚ï¼š441 å¸§ï¼ˆ10ms éŸ³é¢‘ï¼‰
  â”œâ”€ AudioPlayer éœ€è¦ä»é˜Ÿåˆ—å–ï¼š~1 ä¸ªéŸ³é¢‘å¸§
  â””â”€ å¦‚æœé˜Ÿåˆ—è¿˜æ˜¯ç©ºçš„ â†’ ç»§ç»­é™éŸ³

ä¼˜ç‚¹ï¼š
âœ… ç¬¬ä¸€æ¬¡åªéœ€è¦ 4-5 å¸§
âœ… å»¶è¿Ÿä½ï¼ˆ100msï¼‰

ç¼ºç‚¹ï¼š
âŒ ç¼“å†²åŒºå°ï¼Œå®¹é”™æ€§ä½
âŒ é˜Ÿåˆ—ç¨æœ‰ä¸è¶³å°±ä¼šæ–­éŸ³
âŒ åç»­å›è°ƒé¢‘ç¹ï¼Œå¯¹è§£ç é€Ÿåº¦è¦æ±‚é«˜
```

---

## ğŸ’¡ å¸¸è§è¯¯è§£

### è¯¯è§£ 1ï¼šç¬¬ä¸€æ¬¡å›è°ƒåœ¨ç¼“å†²åŒºæ—¶é•¿åå‘ç”Ÿ

âŒ **é”™è¯¯ç†è§£ï¼š**
```
ç¼“å†²åŒº = 1 ç§’
â†’ ç¬¬ä¸€æ¬¡å›è°ƒåœ¨ 1 ç§’åå‘ç”Ÿ
```

âœ… **æ­£ç¡®ç†è§£ï¼š**
```
ç¼“å†²åŒº = 1 ç§’
â†’ ç¬¬ä¸€æ¬¡å›è°ƒåœ¨å¯åŠ¨åå‡ æ¯«ç§’å†…å‘ç”Ÿ
â†’ è¯·æ±‚å¡«å…… 1 ç§’çš„æ•°æ®
â†’ å¡«å……å®Œæˆåï¼ŒéŸ³é¢‘å¼€å§‹æ’­æ”¾
â†’ åç»­æ¯ 10ms å›è°ƒä¸€æ¬¡ï¼Œè¡¥å……è¢«æ¶ˆè´¹çš„æ•°æ®
```

---

### è¯¯è§£ 2ï¼šç¼“å†²åŒºå¤§å°æ˜¯æ’­æ”¾å»¶è¿Ÿ

âŒ **é”™è¯¯ç†è§£ï¼š**
```
ç¼“å†²åŒº = 1 ç§’
â†’ éŸ³é¢‘å»¶è¿Ÿ = 1 ç§’
```

âœ… **æ­£ç¡®ç†è§£ï¼š**
```
ç¼“å†²åŒº = 1 ç§’
â†’ ç¬¬ä¸€ä¸ªé‡‡æ ·ç‚¹çš„å»¶è¿Ÿ â‰ˆ 0msï¼ˆç«‹å³å¼€å§‹æ’­æ”¾ï¼‰
â†’ æœ€åä¸€ä¸ªé‡‡æ ·ç‚¹çš„å»¶è¿Ÿ â‰ˆ 1 ç§’
â†’ å¹³å‡å»¶è¿Ÿ â‰ˆ 500ms
â†’ ä½†éŸ³è§†é¢‘åŒæ­¥ä¸æ˜¯åŸºäºå»¶è¿Ÿï¼Œè€Œæ˜¯åŸºäº PTS
```

**å®é™…å½±å“ï¼š**
- å¯¹äºè§†é¢‘æ’­æ”¾ï¼šå‡ ä¹æ— å½±å“ï¼ˆéŸ³è§†é¢‘éƒ½æœ‰å»¶è¿Ÿï¼‰
- å¯¹äºå®æ—¶å¯¹è®²ï¼šä¼šæœ‰æ˜æ˜¾å»¶è¿Ÿ
- å¯¹äºæ¸¸æˆéŸ³æ•ˆï¼šä¼šæœ‰å»¶è¿Ÿæ„Ÿ

---

### è¯¯è§£ 3ï¼šé˜Ÿåˆ—å¤§å°å’Œç¼“å†²åŒºå¤§å°åº”è¯¥ç›¸åŒ

âŒ **é”™è¯¯ç†è§£ï¼š**
```
WASAPI ç¼“å†²åŒº = 1 ç§’ï¼ˆ43 å¸§ï¼‰
â†’ é˜Ÿåˆ—å¤§å° = 43 å¸§å°±å¤Ÿäº†
```

âœ… **æ­£ç¡®ç†è§£ï¼š**
```
WASAPI ç¼“å†²åŒº = 1 ç§’ï¼ˆéœ€è¦ 43 å¸§ï¼‰
â†’ é˜Ÿåˆ—å¤§å°åº”è¯¥ >> 43 å¸§

åŸå› ï¼š
1. ç¬¬ä¸€æ¬¡å›è°ƒéœ€è¦ 43 å¸§ï¼Œä½†é˜Ÿåˆ—åˆšå¯åŠ¨å¯èƒ½åªæœ‰å‡ å¸§
2. è§£ç é€Ÿåº¦ä¸ç¨³å®šï¼Œéœ€è¦é¢å¤–ç¼“å†²
3. Seekã€æš‚åœç­‰æ“ä½œéœ€è¦é¢„ç•™ç©ºé—´
4. å»ºè®®ï¼šé˜Ÿåˆ—å¤§å° = 3-4 Ã— ç¼“å†²åŒºéœ€æ±‚ = 150 å¸§
```

---

## ğŸ“Š å®é™…æµ‹é‡ç¤ºä¾‹

### æµ‹è¯•ä»£ç ï¼ˆæ·»åŠ åˆ° AudioThreadMainï¼‰

```cpp
void WasapiAudioOutput::AudioThreadMain() {
  MODULE_INFO(LOG_MODULE_AUDIO, "WASAPI audio thread started");
  
  const UINT32 frame_size = wave_format_->nBlockAlign;
  int callback_count = 0;
  
  // ğŸ” è®°å½•å¯åŠ¨æ—¶é—´
  auto start_time = std::chrono::steady_clock::now();

  while (!should_stop_.load()) {
    if (is_paused_.load()) {
      Sleep(10);
      continue;
    }

    UINT32 padding_frames;
    HRESULT hr = audio_client_->GetCurrentPadding(&padding_frames);
    if (FAILED(hr)) {
      break;
    }

    UINT32 available_frames = buffer_frame_count_ - padding_frames;
    if (available_frames == 0) {
      Sleep(1);
      continue;
    }

    // ğŸ” è®°å½•å›è°ƒä¿¡æ¯
    auto now = std::chrono::steady_clock::now();
    auto elapsed = std::chrono::duration_cast<std::chrono::milliseconds>(
        now - start_time).count();
    
    if (callback_count < 5) {  // åªè®°å½•å‰ 5 æ¬¡
      MODULE_INFO(LOG_MODULE_AUDIO,
                  "Callback #{}: time={}ms, padding={}, available={}, "
                  "bytes={}",
                  callback_count, elapsed, padding_frames, available_frames,
                  available_frames * frame_size);
    }

    BYTE* render_buffer;
    hr = render_client_->GetBuffer(available_frames, &render_buffer);
    if (FAILED(hr)) {
      break;
    }

    UINT32 bytes_to_fill = available_frames * frame_size;
    int bytes_filled = 0;
    if (audio_callback_) {
      bytes_filled = audio_callback_(user_data_, render_buffer, bytes_to_fill);
    }

    render_client_->ReleaseBuffer(available_frames, 0);
    callback_count++;
    
    Sleep(10);
  }
}
```

### å®é™…è¾“å‡ºï¼ˆ1 ç§’ç¼“å†²åŒºï¼‰

```
[INFO] WASAPI audio thread started
[INFO] Callback #0: time=2ms, padding=0, available=44100, bytes=176400
       â†‘ ç¬¬ä¸€æ¬¡å›è°ƒï¼šå¯åŠ¨å 2msï¼Œè¯·æ±‚ 44100 å¸§ï¼ˆ1 ç§’ï¼‰
       
[INFO] Callback #1: time=15ms, padding=43659, available=441, bytes=1764
       â†‘ ç¬¬äºŒæ¬¡å›è°ƒï¼šå¯åŠ¨å 15msï¼Œåªè¯·æ±‚ 441 å¸§ï¼ˆ10msï¼‰
       
[INFO] Callback #2: time=26ms, padding=43218, available=882, bytes=3528
       â†‘ ç¬¬ä¸‰æ¬¡å›è°ƒï¼šå¯åŠ¨å 26msï¼Œè¯·æ±‚ 882 å¸§ï¼ˆ20msï¼‰
       
[INFO] Callback #3: time=37ms, padding=43218, available=882, bytes=3528
[INFO] Callback #4: time=48ms, padding=43218, available=882, bytes=3528
```

### å®é™…è¾“å‡ºï¼ˆ100ms ç¼“å†²åŒºï¼‰

```
[INFO] WASAPI audio thread started
[INFO] Callback #0: time=2ms, padding=0, available=4410, bytes=17640
       â†‘ ç¬¬ä¸€æ¬¡å›è°ƒï¼šå¯åŠ¨å 2msï¼Œè¯·æ±‚ 4410 å¸§ï¼ˆ100msï¼‰
       
[INFO] Callback #1: time=14ms, padding=4410, available=0, bytes=0
       â†‘ ç¬¬äºŒæ¬¡å›è°ƒï¼šç¼“å†²åŒºæ»¡ï¼Œä¸éœ€è¦æ•°æ®
       
[INFO] Callback #2: time=25ms, padding=3969, available=441, bytes=1764
       â†‘ ç¬¬ä¸‰æ¬¡å›è°ƒï¼šè¯·æ±‚ 441 å¸§ï¼ˆ10msï¼‰
       
[INFO] Callback #3: time=36ms, padding=3969, available=441, bytes=1764
[INFO] Callback #4: time=47ms, padding=3969, available=441, bytes=1764
```

---

## âœ… å…³é”®ç»“è®º

### 1. ç¬¬ä¸€æ¬¡å›è°ƒçš„æ—¶æœº

```
å¯åŠ¨åç«‹å³ï¼ˆé€šå¸¸ 2-5ms å†…ï¼‰
ä¸æ˜¯ç¼“å†²åŒºæ—¶é•¿åï¼
```

### 2. ç¬¬ä¸€æ¬¡å›è°ƒçš„è¯·æ±‚é‡

```
= ç¼“å†²åŒºå¤§å°ï¼ˆå› ä¸ºç¼“å†²åŒºæ˜¯ç©ºçš„ï¼‰

1 ç§’ç¼“å†²åŒºï¼š44100 å¸§ = 176400 å­—èŠ‚
100ms ç¼“å†²åŒºï¼š4410 å¸§ = 17640 å­—èŠ‚
```

### 3. åç»­å›è°ƒçš„é¢‘ç‡

```
çº¦æ¯ 10ms ä¸€æ¬¡ï¼ˆSleep(10) æ§åˆ¶ï¼‰
æ¯æ¬¡è¯·æ±‚é‡ â‰ˆ 10-20ms çš„éŸ³é¢‘æ•°æ®
```

### 4. é˜Ÿåˆ—å¤§å°çš„è®¾è®¡

```
ä¸æ˜¯åŸºäºç¼“å†²åŒºå¤§å°ï¼Œè€Œæ˜¯åŸºäºï¼š
1. ç¬¬ä¸€æ¬¡å›è°ƒçš„éœ€æ±‚ï¼ˆ43 å¸§ï¼‰
2. è§£ç é€Ÿåº¦çš„æ³¢åŠ¨ï¼ˆ2-3 å€ä½™é‡ï¼‰
3. Seekã€æš‚åœç­‰æ“ä½œçš„é¢„ç•™
â†’ æ¨èï¼š150 å¸§ï¼ˆçº¦ 3-4 å€ç¬¬ä¸€æ¬¡éœ€æ±‚ï¼‰
```

---

## ğŸ¯ æœ€ç»ˆç†è§£

**"ç¬¬ä¸€æ¬¡å›è°ƒ"æ˜¯æŒ‡ï¼š**
- âœ… å¯åŠ¨åçš„ç¬¬ä¸€æ¬¡ `GetBuffer()` è°ƒç”¨
- âœ… å‘ç”Ÿåœ¨å¯åŠ¨åå‡ æ¯«ç§’å†…
- âœ… è¯·æ±‚å¡«å……æ•´ä¸ªç©ºç¼“å†²åŒº
- âŒ ä¸æ˜¯ç¼“å†²åŒºæ—¶é•¿åæ‰å›è°ƒ

**ç¼“å†²åŒºå¤§å°çš„ä½œç”¨ï¼š**
- âœ… å†³å®šç¬¬ä¸€æ¬¡å›è°ƒéœ€è¦å¤šå°‘æ•°æ®
- âœ… å†³å®šå®¹é”™æ€§ï¼ˆç¼“å†²æ—¶é•¿ï¼‰
- âœ… å†³å®šå»¶è¿Ÿç‰¹æ€§
- âŒ ä¸å†³å®šå›è°ƒæ—¶æœºï¼ˆå›è°ƒæ€»æ˜¯ç«‹å³å¼€å§‹ï¼‰

å¸Œæœ›è¿™æ ·è§£é‡Šæ¸…æ¥šäº†ï¼ğŸ¯
