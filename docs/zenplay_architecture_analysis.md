# ğŸ—ï¸ ZenPlayåª’ä½“æ’­æ”¾å™¨æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

ZenPlayæ˜¯ä¸€ä¸ªåŸºäºC++17çš„è·¨å¹³å°å¤šåª’ä½“æ’­æ”¾å™¨ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒéŸ³è§†é¢‘æ’­æ”¾å’Œç²¾ç¡®çš„éŸ³è§†é¢‘åŒæ­¥ã€‚

### æŠ€æœ¯æ ˆ
- **è¯­è¨€**: C++17
- **UIæ¡†æ¶**: Qt6 (Core, Widgets, Gui)
- **å¤šåª’ä½“**: FFmpeg (avutil, avcodec, avformat, avfilter, swscale, swresample)
- **éŸ³é¢‘è¾“å‡º**: WASAPI (Windows), ALSA (Linux)
- **è§†é¢‘æ¸²æŸ“**: SDL2 (ç¡¬ä»¶åŠ é€Ÿ)
- **çº¿ç¨‹æ¡†æ¶**: Loki (è‡ªå®šä¹‰ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ)
- **æ—¥å¿—**: spdlog
- **JSON**: nlohmann_json

---

## ğŸ›ï¸ **æ•´ä½“æ¶æ„**

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     UI Layer (Qt6)                         â”‚
â”‚                  MainWindow + VideoDisplayWidget           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Application Layer                           â”‚
â”‚                      ZenPlayer                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Core Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PlaybackControllerâ”‚ â”‚AVSyncControllerâ”‚ â”‚ThreadSafeQueuesâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Component Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚AudioPlayer  â”‚ â”‚VideoPlayer  â”‚ â”‚  Media Processing    â”‚   â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚ Demuxer,Decoders    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Platform Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚AudioOutput  â”‚ â”‚ Renderer    â”‚ â”‚     Threading       â”‚    â”‚
â”‚  â”‚WASAPI/ALSA  â”‚ â”‚SDL2/OpenGL  â”‚ â”‚   Loki + std::threadâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© **æ ¸å¿ƒç»„ä»¶è¯¦è§£**

### 1. **ZenPlayer (åº”ç”¨å±‚ä¸»å…¥å£)**
```cpp
class ZenPlayer {
    // èŒè´£ï¼šç»Ÿä¸€çš„æ’­æ”¾å™¨æ¥å£ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†
    â”œâ”€â”€ Open(url) â†’ æ‰“å¼€åª’ä½“æ–‡ä»¶
    â”œâ”€â”€ Play/Pause/Stop â†’ æ’­æ”¾æ§åˆ¶
    â”œâ”€â”€ SetRenderWindow() â†’ è®¾ç½®æ¸²æŸ“çª—å£
    â””â”€â”€ Seek() â†’ æ’­æ”¾ä½ç½®è·³è½¬
}
```

**ç»„ä»¶å…³ç³»**ï¼š
- æ‹¥æœ‰: Demuxer, VideoDecoder, AudioDecoder, Renderer
- åˆ›å»ºå’Œç®¡ç†: PlaybackController
- ç”Ÿå‘½å‘¨æœŸ: æ•´ä¸ªæ’­æ”¾ä¼šè¯

### 2. **PlaybackController (æ ¸å¿ƒåè°ƒå™¨)**
```cpp
class PlaybackController {
    // èŒè´£ï¼šç»Ÿä¸€åè°ƒéŸ³è§†é¢‘æ’­æ”¾å’ŒåŒæ­¥
    â”œâ”€â”€ çº¿ç¨‹ç®¡ç†: DemuxTask, VideoDecodeTask, AudioDecodeTask, SyncControlTask
    â”œâ”€â”€ æ•°æ®æµ: ThreadSafeQueue<AVPacket*> 
    â”œâ”€â”€ æ’­æ”¾å™¨åè°ƒ: AudioPlayer, VideoPlayer
    â””â”€â”€ åŒæ­¥æ§åˆ¶: AVSyncController
}
```

**çº¿ç¨‹æ¶æ„**ï¼š
```
PlaybackController
â”œâ”€â”€ DemuxTask (std::thread) â†’ è§£å°è£…å¾ªç¯
â”œâ”€â”€ VideoDecodeTask (std::thread) â†’ è§†é¢‘è§£ç å¾ªç¯  
â”œâ”€â”€ AudioDecodeTask (std::thread) â†’ éŸ³é¢‘è§£ç å¾ªç¯
â””â”€â”€ SyncControlTask (std::thread) â†’ åŒæ­¥ç›‘æ§å¾ªç¯
```

### 3. **éŸ³é¢‘å­ç³»ç»Ÿ**
```cpp
AudioPlayer {
    â”œâ”€â”€ éŸ³é¢‘é˜Ÿåˆ—ç®¡ç† â†’ ThreadSafeQueue<AVFrame>
    â”œâ”€â”€ æ ¼å¼è½¬æ¢ â†’ SwrContext (é‡é‡‡æ ·)
    â”œâ”€â”€ è·¨å¹³å°è¾“å‡º â†’ AudioOutputæ¥å£
    â””â”€â”€ æ—¶é’Ÿæ›´æ–° â†’ AVSyncController
}

AudioOutputæ¥å£ {
    â”œâ”€â”€ WasapiAudioOutput (Windows) â†’ WASAPIä½å»¶è¿Ÿæ’­æ”¾
    â””â”€â”€ AlsaAudioOutput (Linux) â†’ ALSAå…¼å®¹æ€§æ’­æ”¾
}
```

### 4. **è§†é¢‘å­ç³»ç»Ÿ**
```cpp
VideoPlayer {
    â”œâ”€â”€ è§†é¢‘é˜Ÿåˆ—ç®¡ç† â†’ ThreadSafeQueue<VideoFrame>
    â”œâ”€â”€ åŒæ­¥è®¡ç®— â†’ CalculateFrameDisplayTime()
    â”œâ”€â”€ ä¸¢å¸§ç­–ç•¥ â†’ ShouldDropFrame()
    â”œâ”€â”€ æ¸²æŸ“è°ƒåº¦ â†’ VideoRenderThread
    â””â”€â”€ æ—¶é’Ÿæ›´æ–° â†’ AVSyncController
}

Rendereræ¥å£ {
    â””â”€â”€ SDLRenderer â†’ SDL2ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“
}

RendererProxy â†’ çº¿ç¨‹å®‰å…¨æ¸²æŸ“ä»£ç†
```

### 5. **éŸ³è§†é¢‘åŒæ­¥ç³»ç»Ÿ**
```cpp
AVSyncController {
    â”œâ”€â”€ æ—¶é’Ÿç®¡ç†: AudioClock, VideoClock, SystemClock
    â”œâ”€â”€ åŒæ­¥ç­–ç•¥: AUDIO_MASTER (æ¨è)
    â”œâ”€â”€ åç§»è®¡ç®—: CalculateVideoDelay()
    â”œâ”€â”€ åŒæ­¥ç»Ÿè®¡: SyncStats
    â””â”€â”€ è´¨é‡ç›‘æ§: is_in_sync(), sync_quality()
}
```

---

## ğŸ”„ **æ•°æ®æµå’Œå¤„ç†æµç¨‹**

### åª’ä½“æ’­æ”¾å®Œæ•´æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æ‰“å¼€æ–‡ä»¶] --> B[ZenPlayer.Open]
    B --> C[Demuxer.Open]
    C --> D[åˆå§‹åŒ–Decoders]
    D --> E[åˆ›å»ºPlaybackController]
    E --> F[å¯åŠ¨è§£ç çº¿ç¨‹]
    
    F --> G[DemuxTaskçº¿ç¨‹]
    G --> H[è¯»å–AVPacket]
    H --> I{åˆ†å‘åˆ°é˜Ÿåˆ—}
    I --> J[VideoPacketQueue]
    I --> K[AudioPacketQueue]
    
    J --> L[VideoDecodeTask]
    K --> M[AudioDecodeTask]
    
    L --> N[è§£ç AVFrame]
    M --> O[è§£ç AVFrame]
    
    N --> P[VideoPlayer.PushFrame]
    O --> Q[AudioPlayer.PushFrame]
    
    P --> R[VideoRenderThread]
    Q --> S[AudioOutputCallback]
    
    R --> T[åŒæ­¥è®¡ç®—]
    S --> U[éŸ³é¢‘æ—¶é’Ÿæ›´æ–°]
    
    T --> V[RendererProxy]
    U --> W[AVSyncController]
    
    V --> X[SDLæ¸²æŸ“]
    W --> Y[æ—¶é’ŸåŒæ­¥]
```

### çº¿ç¨‹æ¨¡å‹è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Thread     â”‚    â”‚  Worker Threads  â”‚    â”‚ Loki Task Pool  â”‚
â”‚   (loki::UI)    â”‚    â”‚  (std::thread)   â”‚    â”‚ (IO/NET/DB)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ UIæ›´æ–°        â”‚    â”‚ â€¢ DemuxTask      â”‚    â”‚ â€¢ å¼‚æ­¥IO       â”‚
â”‚ â€¢ ç”¨æˆ·äº¤äº’      â”‚    â”‚ â€¢ VideoDecodeTaskâ”‚    â”‚ â€¢ ç½‘ç»œè¯·æ±‚     â”‚
â”‚ â€¢ æ¸²æŸ“è°ƒåº¦      â”‚â—„â”€â–º â”‚ â€¢ AudioDecodeTaskâ”‚â—„â”€â–º â”‚ â€¢ æ–‡ä»¶æ“ä½œ     â”‚
â”‚ â€¢ çŠ¶æ€é€šçŸ¥      â”‚    â”‚ â€¢ SyncControlTaskâ”‚    â”‚ â€¢ çŸ­ä»»åŠ¡       â”‚
â”‚ â€¢ RendererProxy â”‚    â”‚ â€¢ VideoRenderThreadâ”‚   â”‚ â€¢ å®šæ—¶ä»»åŠ¡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ AudioCallback  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éŸ³è§†é¢‘åŒæ­¥æµç¨‹

```
æ—¶é—´è½´: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’

éŸ³é¢‘: â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ªâ”€â”€â™ª (ä¸»æ—¶é’Ÿ)
       â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
       â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼
åŒæ­¥: è®¡ç®—åŒæ­¥åç§» â†’ è°ƒæ•´è§†é¢‘æ˜¾ç¤ºæ—¶é—´
       â–²  â–²  â–²  â–²  â–²  â–²  â–²  â–²  â–²  â–²  â–²
       â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
è§†é¢‘: ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬â”€ğŸ¬
     (è·ŸéšéŸ³é¢‘æ—¶é’Ÿï¼Œä¸¢å¸§/ç­‰å¾…è°ƒæ•´)
```

---

## ğŸ“Š **æ ¸å¿ƒç±»èŒè´£çŸ©é˜µ**

| ç±»å | ä¸»è¦èŒè´£ | ä¾èµ–å…³ç³» | çº¿ç¨‹æ¨¡å‹ |
|------|---------|----------|----------|
| **ZenPlayer** | ç»Ÿä¸€æ’­æ”¾æ¥å£ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç† | æ‹¥æœ‰æ‰€æœ‰ç»„ä»¶ | UIçº¿ç¨‹ |
| **PlaybackController** | åè°ƒæ‰€æœ‰æ’­æ”¾çº¿ç¨‹å’Œç»„ä»¶ | ç®¡ç†æ‰€æœ‰æ’­æ”¾å™¨ç»„ä»¶ | å¤šçº¿ç¨‹ç®¡ç†å™¨ |
| **AudioPlayer** | éŸ³é¢‘æ’­æ”¾å’Œæ ¼å¼è½¬æ¢ | AVSyncController, AudioOutput | å†…éƒ¨çº¿ç¨‹+å›è°ƒ |
| **VideoPlayer** | è§†é¢‘æ¸²æŸ“å’Œå¸§æ—¶åº | AVSyncController, Renderer | å†…éƒ¨æ¸²æŸ“çº¿ç¨‹ |
| **AVSyncController** | éŸ³è§†é¢‘æ—¶é’ŸåŒæ­¥ | è¢«éŸ³è§†é¢‘æ’­æ”¾å™¨ä½¿ç”¨ | çº¿ç¨‹å®‰å…¨ |
| **Demuxer** | åª’ä½“è§£å°è£… | FFmpeg | DemuxTaskçº¿ç¨‹ |
| **VideoDecoder** | è§†é¢‘è§£ç  | FFmpeg | VideoDecodeTaskçº¿ç¨‹ |
| **AudioDecoder** | éŸ³é¢‘è§£ç  | FFmpeg | AudioDecodeTaskçº¿ç¨‹ |
| **AudioOutput** | è·¨å¹³å°éŸ³é¢‘è¾“å‡º | ç³»ç»ŸéŸ³é¢‘API | éŸ³é¢‘è®¾å¤‡å›è°ƒçº¿ç¨‹ |
| **Renderer** | è·¨å¹³å°è§†é¢‘æ¸²æŸ“ | SDL2/OpenGL | UIçº¿ç¨‹(é€šè¿‡RendererProxy) |
| **RendererProxy** | çº¿ç¨‹å®‰å…¨æ¸²æŸ“ä»£ç† | Lokiçº¿ç¨‹æ¡†æ¶ | è·¨çº¿ç¨‹è°ƒåº¦ |

---

## âš ï¸ **æ¶æ„é—®é¢˜åˆ†æä¸æ”¹è¿›å»ºè®®**

### ğŸ” **å‘ç°çš„é—®é¢˜**

#### 1. **çº¿ç¨‹æ¶æ„æ··åˆé—®é¢˜** âš ï¸
```cpp
// é—®é¢˜ï¼šæ··åˆä½¿ç”¨std::threadå’ŒLokiçº¿ç¨‹ç³»ç»Ÿ
PlaybackController {
    std::thread demux_thread_;      // âœ… æ­£ç¡®ï¼šé•¿æœŸè¿è¡Œ
    std::thread decode_threads_;    // âœ… æ­£ç¡®ï¼šæŒç»­å¤„ç†
}

// ä½†æ˜¯ï¼š
RendererProxy â†’ loki::UI           // âœ… æ­£ç¡®ï¼šUIä»»åŠ¡è°ƒåº¦
æŸäº›çŸ­ä»»åŠ¡å¯èƒ½é”™è¯¯ä½¿ç”¨std::thread    // âŒ åº”è¯¥ç”¨Loki
```

#### 2. **UIå±‚ä¸æ’­æ”¾å™¨å±‚è€¦åˆ** âš ï¸
```cpp
// é—®é¢˜ï¼šMainWindowç›´æ¥ä½¿ç”¨VideoPlayer
MainWindow {
    std::unique_ptr<VideoPlayer> player_;  // âŒ åº”è¯¥ä½¿ç”¨ZenPlayer
}

// åº”è¯¥æ˜¯ï¼š
MainWindow {
    std::unique_ptr<ZenPlayer> player_;    // âœ… æ­£ç¡®çš„æŠ½è±¡å±‚æ¬¡
}
```

#### 3. **é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€** âš ï¸
- æœ‰äº›ç»„ä»¶ä½¿ç”¨boolè¿”å›å€¼
- æœ‰äº›ä½¿ç”¨å¼‚å¸¸
- ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç­–ç•¥

#### 4. **èµ„æºç®¡ç†å¯èƒ½å­˜åœ¨é—®é¢˜** âš ï¸
```cpp
// æ½œåœ¨é—®é¢˜ï¼šAVFrame/AVPacketçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
AVFramePtr frame(...);  // éœ€è¦ç¡®ä¿æ­£ç¡®çš„deleter
AVPacket* packet;       // éœ€è¦ç¡®ä¿av_packet_freeè°ƒç”¨
```

### ğŸ”§ **æ”¹è¿›å»ºè®®**

#### 1. **ç»Ÿä¸€UIå±‚æ¥å£**
```cpp
// ä¿®æ”¹å‰
class MainWindow {
    std::unique_ptr<VideoPlayer> player_;  // âŒ
};

// ä¿®æ”¹å
class MainWindow {
    std::unique_ptr<ZenPlayer> player_;    // âœ…
};
```

#### 2. **å®Œå–„é”™è¯¯å¤„ç†ç³»ç»Ÿ**
```cpp
// å»ºè®®ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
enum class PlayerError {
    None,
    FileNotFound,
    CodecNotSupported,
    AudioDeviceError,
    MemoryError
};

class Result<T> {
    PlayerError error;
    T value;
};
```

#### 3. **ä¼˜åŒ–çº¿ç¨‹ä½¿ç”¨ç­–ç•¥**
```cpp
// æ˜ç¡®çº¿ç¨‹ä½¿ç”¨åŸåˆ™ï¼š
// âœ… std::thread: é•¿æœŸè¿è¡Œçš„æ•°æ®å¤„ç†å¾ªç¯
// âœ… loki::PostTask: çŸ­ä»»åŠ¡å’ŒUIæ›´æ–°
// âœ… éŸ³é¢‘å›è°ƒ: ç³»ç»Ÿç®¡ç†çš„å®æ—¶çº¿ç¨‹
```

#### 4. **å¢å¼ºåŒæ­¥ç›‘æ§**
```cpp
// å»ºè®®ï¼šæ·»åŠ æ›´è¯¦ç»†çš„æ€§èƒ½ç›‘æ§
struct DetailedStats {
    // é˜Ÿåˆ—ç›‘æ§
    size_t video_queue_depth;
    size_t audio_queue_depth;
    
    // æ€§èƒ½ç›‘æ§
    double decode_fps;
    double render_fps;
    double cpu_usage;
    
    // åŒæ­¥è´¨é‡
    double avg_sync_error;
    int64_t sync_corrections;
};
```

#### 5. **é…ç½®ç³»ç»Ÿ**
```cpp
// å»ºè®®ï¼šæ·»åŠ å¯é…ç½®å‚æ•°
struct PlayerConfig {
    // éŸ³é¢‘é…ç½®
    int audio_buffer_size = 1024;
    int target_sample_rate = 44100;
    
    // è§†é¢‘é…ç½®  
    bool enable_hardware_decode = true;
    int max_frame_queue_size = 30;
    
    // åŒæ­¥é…ç½®
    double sync_threshold_ms = 40.0;
    bool enable_frame_drop = true;
};
```

---

## ğŸ¯ **æ¶æ„ä¼˜åŠ¿**

### âœ… **è®¾è®¡äº®ç‚¹**
1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»** - æ¯ä¸ªç»„ä»¶èŒè´£æ˜ç¡®
2. **å¯¹ç§°çš„éŸ³è§†é¢‘æ¶æ„** - AudioPlayerå’ŒVideoPlayeråœ°ä½å¹³ç­‰
3. **ç²¾ç¡®çš„åŒæ­¥ç³»ç»Ÿ** - ä¸“ä¸šçº§AVSyncController
4. **çº¿ç¨‹å®‰å…¨è®¾è®¡** - ThreadSafeQueueå’ŒRendererProxy
5. **è·¨å¹³å°æŠ½è±¡** - AudioOutputå’ŒRendereræ¥å£
6. **ç°ä»£C++ç‰¹æ€§** - æ™ºèƒ½æŒ‡é’ˆã€RAIIã€åŸå­æ“ä½œ

### ğŸš€ **æ‰©å±•æ€§**
- æ”¯æŒæ–°çš„éŸ³é¢‘/è§†é¢‘æ ¼å¼ (é€šè¿‡FFmpeg)
- æ”¯æŒæ–°çš„å¹³å° (é€šè¿‡AudioOutput/Rendereræ¥å£)
- æ”¯æŒæ’ä»¶ç³»ç»Ÿ (é€šè¿‡æŠ½è±¡æ¥å£)
- æ”¯æŒç½‘ç»œæµåª’ä½“ (Demuxerå·²æ”¯æŒ)

---

## ğŸ“ˆ **æ€§èƒ½ç‰¹æ€§**

### ğŸ”¥ **é«˜æ€§èƒ½è®¾è®¡**
1. **å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†** - è§£å°è£…ã€è§£ç ã€æ¸²æŸ“å¹¶è¡Œ
2. **ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“** - SDL2 + OpenGL/D3D
3. **ä½å»¶è¿ŸéŸ³é¢‘** - WASAPIç‹¬å æ¨¡å¼æ”¯æŒ
4. **æ™ºèƒ½ç¼“å†²ç®¡ç†** - åŠ¨æ€é˜Ÿåˆ—å¤§å°æ§åˆ¶
5. **è‡ªé€‚åº”ä¸¢å¸§** - ä¿æŒåŒæ­¥æ€§èƒ½

### ğŸ“Š **å†…å­˜ç®¡ç†**
- RAIIèµ„æºç®¡ç†
- æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨é‡Šæ”¾
- å¾ªç¯ç¼“å†²åŒºå¤ç”¨
- åŠæ—¶é‡Šæ”¾è§£ç å¸§

---

## ğŸ›¡ï¸ **ç¨³å®šæ€§ä¿è¯**

### ğŸ”’ **çº¿ç¨‹å®‰å…¨**
- æ‰€æœ‰é˜Ÿåˆ—ä½¿ç”¨mutexä¿æŠ¤
- åŸå­æ“ä½œæ§åˆ¶çŠ¶æ€
- RendererProxyç¡®ä¿UIçº¿ç¨‹æ¸²æŸ“
- AVSyncControllerå†…éƒ¨åŒæ­¥

### ğŸš¨ **é”™è¯¯æ¢å¤**
- è§£ç å¤±è´¥è‡ªåŠ¨è·³è¿‡å¸§
- éŸ³é¢‘è®¾å¤‡æ–­å¼€é‡è¿
- ç½‘ç»œä¸­æ–­è‡ªåŠ¨é‡è¯•
- å†…å­˜ä¸è¶³ä¼˜é›…é™çº§

è¿™ä¸ªæ¶æ„è®¾è®¡åœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œç¡®ä¿äº†è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¤šåª’ä½“æ’­æ”¾å™¨æ¶æ„ï¼ğŸ‰
